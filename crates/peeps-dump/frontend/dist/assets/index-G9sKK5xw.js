(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerPolicy&&(i.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?i.credentials="include":c.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(c){if(c.ep)return;c.ep=!0;const i=r(c);fetch(c.href,i)}})();var Y,y,$e,H,de,Te,Se,xe,ce,ne,te,W={},Pe=[],Xe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,J=Array.isArray;function E(n,t){for(var r in t)n[r]=t[r];return n}function ie(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function je(n,t,r){var s,c,i,o={};for(i in t)i=="key"?s=t[i]:i=="ref"?c=t[i]:o[i]=t[i];if(arguments.length>2&&(o.children=arguments.length>3?Y.call(arguments,2):r),typeof n=="function"&&n.defaultProps!=null)for(i in n.defaultProps)o[i]===void 0&&(o[i]=n.defaultProps[i]);return V(n,o,s,c,null)}function V(n,t,r,s,c){var i={type:n,props:t,key:r,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:c??++$e,__i:-1,__u:0};return c==null&&y.vnode!=null&&y.vnode(i),i}function B(n){return n.children}function X(n,t){this.props=n,this.context=t}function O(n,t){if(t==null)return n.__?O(n.__,n.__i+1):null;for(var r;t<n.__k.length;t++)if((r=n.__k[t])!=null&&r.__e!=null)return r.__e;return typeof n.type=="function"?O(n):null}function Ne(n){var t,r;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,t=0;t<n.__k.length;t++)if((r=n.__k[t])!=null&&r.__e!=null){n.__e=n.__c.base=r.__e;break}return Ne(n)}}function _e(n){(!n.__d&&(n.__d=!0)&&H.push(n)&&!K.__r++||de!=y.debounceRendering)&&((de=y.debounceRendering)||Te)(K)}function K(){for(var n,t,r,s,c,i,o,d=1;H.length;)H.length>d&&H.sort(Se),n=H.shift(),d=H.length,n.__d&&(r=void 0,s=void 0,c=(s=(t=n).__v).__e,i=[],o=[],t.__P&&((r=E({},s)).__v=s.__v+1,y.vnode&&y.vnode(r),oe(t.__P,r,s,t.__n,t.__P.namespaceURI,32&s.__u?[c]:null,i,c??O(s),!!(32&s.__u),o),r.__v=s.__v,r.__.__k[r.__i]=r,Fe(i,r,o),s.__e=s.__=null,r.__e!=c&&Ne(r)));K.__r=0}function Re(n,t,r,s,c,i,o,d,l,_,p){var a,h,u,k,f,b,g,m=s&&s.__k||Pe,T=t.length;for(l=Ke(r,t,m,l,T),a=0;a<T;a++)(u=r.__k[a])!=null&&(h=u.__i==-1?W:m[u.__i]||W,u.__i=a,b=oe(n,u,h,c,i,o,d,l,_,p),k=u.__e,u.ref&&h.ref!=u.ref&&(h.ref&&ae(h.ref,null,u),p.push(u.ref,u.__c||k,u)),f==null&&k!=null&&(f=k),(g=!!(4&u.__u))||h.__k===u.__k?l=Ee(u,l,n,g):typeof u.type=="function"&&b!==void 0?l=b:k&&(l=k.nextSibling),u.__u&=-7);return r.__e=f,l}function Ke(n,t,r,s,c){var i,o,d,l,_,p=r.length,a=p,h=0;for(n.__k=new Array(c),i=0;i<c;i++)(o=t[i])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=n.__k[i]=V(null,o,null,null,null):J(o)?o=n.__k[i]=V(B,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?o=n.__k[i]=V(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):n.__k[i]=o,l=i+h,o.__=n,o.__b=n.__b+1,d=null,(_=o.__i=Ge(o,r,l,a))!=-1&&(a--,(d=r[_])&&(d.__u|=2)),d==null||d.__v==null?(_==-1&&(c>p?h--:c<p&&h++),typeof o.type!="function"&&(o.__u|=4)):_!=l&&(_==l-1?h--:_==l+1?h++:(_>l?h--:h++,o.__u|=4))):n.__k[i]=null;if(a)for(i=0;i<p;i++)(d=r[i])!=null&&(2&d.__u)==0&&(d.__e==s&&(s=O(d)),Ae(d,d));return s}function Ee(n,t,r,s){var c,i;if(typeof n.type=="function"){for(c=n.__k,i=0;c&&i<c.length;i++)c[i]&&(c[i].__=n,t=Ee(c[i],t,r,s));return t}n.__e!=t&&(s&&(t&&n.type&&!t.parentNode&&(t=O(n)),r.insertBefore(n.__e,t||null)),t=n.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Ge(n,t,r,s){var c,i,o,d=n.key,l=n.type,_=t[r],p=_!=null&&(2&_.__u)==0;if(_===null&&d==null||p&&d==_.key&&l==_.type)return r;if(s>(p?1:0)){for(c=r-1,i=r+1;c>=0||i<t.length;)if((_=t[o=c>=0?c--:i++])!=null&&(2&_.__u)==0&&d==_.key&&l==_.type)return o}return-1}function he(n,t,r){t[0]=="-"?n.setProperty(t,r??""):n[t]=r==null?"":typeof r!="number"||Xe.test(t)?r:r+"px"}function z(n,t,r,s,c){var i,o;e:if(t=="style")if(typeof r=="string")n.style.cssText=r;else{if(typeof s=="string"&&(n.style.cssText=s=""),s)for(t in s)r&&t in r||he(n.style,t,"");if(r)for(t in r)s&&r[t]==s[t]||he(n.style,t,r[t])}else if(t[0]=="o"&&t[1]=="n")i=t!=(t=t.replace(xe,"$1")),o=t.toLowerCase(),t=o in n||t=="onFocusOut"||t=="onFocusIn"?o.slice(2):t.slice(2),n.l||(n.l={}),n.l[t+i]=r,r?s?r.u=s.u:(r.u=ce,n.addEventListener(t,i?te:ne,i)):n.removeEventListener(t,i?te:ne,i);else{if(c=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in n)try{n[t]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&t[4]!="-"?n.removeAttribute(t):n.setAttribute(t,t=="popover"&&r==1?"":r))}}function ue(n){return function(t){if(this.l){var r=this.l[t.type+n];if(t.t==null)t.t=ce++;else if(t.t<r.u)return;return r(y.event?y.event(t):t)}}}function oe(n,t,r,s,c,i,o,d,l,_){var p,a,h,u,k,f,b,g,m,T,S,F,x,P,U,D,Q,N=t.type;if(t.constructor!==void 0)return null;128&r.__u&&(l=!!(32&r.__u),i=[d=t.__e=r.__e]),(p=y.__b)&&p(t);e:if(typeof N=="function")try{if(g=t.props,m="prototype"in N&&N.prototype.render,T=(p=N.contextType)&&s[p.__c],S=p?T?T.props.value:p.__:s,r.__c?b=(a=t.__c=r.__c).__=a.__E:(m?t.__c=a=new N(g,S):(t.__c=a=new X(g,S),a.constructor=N,a.render=Je),T&&T.sub(a),a.state||(a.state={}),a.__n=s,h=a.__d=!0,a.__h=[],a._sb=[]),m&&a.__s==null&&(a.__s=a.state),m&&N.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=E({},a.__s)),E(a.__s,N.getDerivedStateFromProps(g,a.__s))),u=a.props,k=a.state,a.__v=t,h)m&&N.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),m&&a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(m&&N.getDerivedStateFromProps==null&&g!==u&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(g,S),t.__v==r.__v||!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(g,a.__s,S)===!1){for(t.__v!=r.__v&&(a.props=g,a.state=a.__s,a.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.some(function(M){M&&(M.__=t)}),F=0;F<a._sb.length;F++)a.__h.push(a._sb[F]);a._sb=[],a.__h.length&&o.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(g,a.__s,S),m&&a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(u,k,f)})}if(a.context=S,a.props=g,a.__P=n,a.__e=!1,x=y.__r,P=0,m){for(a.state=a.__s,a.__d=!1,x&&x(t),p=a.render(a.props,a.state,a.context),U=0;U<a._sb.length;U++)a.__h.push(a._sb[U]);a._sb=[]}else do a.__d=!1,x&&x(t),p=a.render(a.props,a.state,a.context),a.state=a.__s;while(a.__d&&++P<25);a.state=a.__s,a.getChildContext!=null&&(s=E(E({},s),a.getChildContext())),m&&!h&&a.getSnapshotBeforeUpdate!=null&&(f=a.getSnapshotBeforeUpdate(u,k)),D=p,p!=null&&p.type===B&&p.key==null&&(D=He(p.props.children)),d=Re(n,J(D)?D:[D],t,r,s,c,i,o,d,l,_),a.base=t.__e,t.__u&=-161,a.__h.length&&o.push(a),b&&(a.__E=a.__=null)}catch(M){if(t.__v=null,l||i!=null)if(M.then){for(t.__u|=l?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;i[i.indexOf(d)]=null,t.__e=d}else{for(Q=i.length;Q--;)ie(i[Q]);se(t)}else t.__e=r.__e,t.__k=r.__k,M.then||se(t);y.__e(M,t,r)}else i==null&&t.__v==r.__v?(t.__k=r.__k,t.__e=r.__e):d=t.__e=Ye(r.__e,t,r,s,c,i,o,l,_);return(p=y.diffed)&&p(t),128&t.__u?void 0:d}function se(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(se)}function Fe(n,t,r){for(var s=0;s<r.length;s++)ae(r[s],r[++s],r[++s]);y.__c&&y.__c(t,n),n.some(function(c){try{n=c.__h,c.__h=[],n.some(function(i){i.call(c)})}catch(i){y.__e(i,c.__v)}})}function He(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:J(n)?n.map(He):E({},n)}function Ye(n,t,r,s,c,i,o,d,l){var _,p,a,h,u,k,f,b=r.props||W,g=t.props,m=t.type;if(m=="svg"?c="http://www.w3.org/2000/svg":m=="math"?c="http://www.w3.org/1998/Math/MathML":c||(c="http://www.w3.org/1999/xhtml"),i!=null){for(_=0;_<i.length;_++)if((u=i[_])&&"setAttribute"in u==!!m&&(m?u.localName==m:u.nodeType==3)){n=u,i[_]=null;break}}if(n==null){if(m==null)return document.createTextNode(g);n=document.createElementNS(c,m,g.is&&g),d&&(y.__m&&y.__m(t,i),d=!1),i=null}if(m==null)b===g||d&&n.data==g||(n.data=g);else{if(i=i&&Y.call(n.childNodes),!d&&i!=null)for(b={},_=0;_<n.attributes.length;_++)b[(u=n.attributes[_]).name]=u.value;for(_ in b)if(u=b[_],_!="children"){if(_=="dangerouslySetInnerHTML")a=u;else if(!(_ in g)){if(_=="value"&&"defaultValue"in g||_=="checked"&&"defaultChecked"in g)continue;z(n,_,null,u,c)}}for(_ in g)u=g[_],_=="children"?h=u:_=="dangerouslySetInnerHTML"?p=u:_=="value"?k=u:_=="checked"?f=u:d&&typeof u!="function"||b[_]===u||z(n,_,u,b[_],c);if(p)d||a&&(p.__html==a.__html||p.__html==n.innerHTML)||(n.innerHTML=p.__html),t.__k=[];else if(a&&(n.innerHTML=""),Re(t.type=="template"?n.content:n,J(h)?h:[h],t,r,s,m=="foreignObject"?"http://www.w3.org/1999/xhtml":c,i,o,i?i[0]:r.__k&&O(r,0),d,l),i!=null)for(_=i.length;_--;)ie(i[_]);d||(_="value",m=="progress"&&k==null?n.removeAttribute("value"):k!=null&&(k!==n[_]||m=="progress"&&!k||m=="option"&&k!=b[_])&&z(n,_,k,b[_],c),_="checked",f!=null&&f!=n[_]&&z(n,_,f,b[_],c))}return n}function ae(n,t,r){try{if(typeof n=="function"){var s=typeof n.__u=="function";s&&n.__u(),s&&t==null||(n.__u=n(t))}else n.current=t}catch(c){y.__e(c,r)}}function Ae(n,t,r){var s,c;if(y.unmount&&y.unmount(n),(s=n.ref)&&(s.current&&s.current!=n.__e||ae(s,null,t)),(s=n.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(i){y.__e(i,t)}s.base=s.__P=null}if(s=n.__k)for(c=0;c<s.length;c++)s[c]&&Ae(s[c],t,r||typeof n.type!="function");r||ie(n.__e),n.__c=n.__=n.__e=void 0}function Je(n,t,r){return this.constructor(n,r)}function Qe(n,t,r){var s,c,i,o;t==document&&(t=document.documentElement),y.__&&y.__(n,t),c=(s=!1)?null:t.__k,i=[],o=[],oe(t,n=t.__k=je(B,null,[n]),c||W,W,t.namespaceURI,c?null:t.firstChild?Y.call(t.childNodes):null,i,c?c.__e:t.firstChild,s,o),Fe(i,n,o)}Y=Pe.slice,y={__e:function(n,t,r,s){for(var c,i,o;t=t.__;)if((c=t.__c)&&!c.__)try{if((i=c.constructor)&&i.getDerivedStateFromError!=null&&(c.setState(i.getDerivedStateFromError(n)),o=c.__d),c.componentDidCatch!=null&&(c.componentDidCatch(n,s||{}),o=c.__d),o)return c.__E=c}catch(d){n=d}throw n}},$e=0,X.prototype.setState=function(n,t){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=E({},this.state),typeof n=="function"&&(n=n(E({},r),this.props)),n&&E(r,n),n!=null&&this.__v&&(t&&this._sb.push(t),_e(this))},X.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),_e(this))},X.prototype.render=B,H=[],Te=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Se=function(n,t){return n.__v.__b-t.__v.__b},K.__r=0,xe=/(PointerCapture)$|Capture$/i,ce=0,ne=ue(!1),te=ue(!0);var Ze=0;function e(n,t,r,s,c,i){t||(t={});var o,d,l=t;if("ref"in l)for(d in l={},t)d=="ref"?o=t[d]:l[d]=t[d];var _={type:n,props:l,key:r,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Ze,__i:-1,__u:0,__source:c,__self:i};if(typeof n=="function"&&(o=n.defaultProps))for(d in o)l[d]===void 0&&(l[d]=o[d]);return y.vnode&&y.vnode(_),_}var q,w,Z,pe,G=0,Me=[],C=y,fe=C.__b,me=C.__r,ge=C.diffed,ve=C.__c,ye=C.unmount,ke=C.__;function le(n,t){C.__h&&C.__h(w,n,G||t),G=0;var r=w.__H||(w.__H={__:[],__h:[]});return n>=r.__.length&&r.__.push({}),r.__[n]}function I(n){return G=1,en(Oe,n)}function en(n,t,r){var s=le(q++,2);if(s.t=n,!s.__c&&(s.__=[Oe(void 0,t),function(d){var l=s.__N?s.__N[0]:s.__[0],_=s.t(l,d);l!==_&&(s.__N=[_,s.__[1]],s.__c.setState({}))}],s.__c=w,!w.__f)){var c=function(d,l,_){if(!s.__c.__H)return!0;var p=s.__c.__H.__.filter(function(h){return!!h.__c});if(p.every(function(h){return!h.__N}))return!i||i.call(this,d,l,_);var a=s.__c.props!==d;return p.forEach(function(h){if(h.__N){var u=h.__[0];h.__=h.__N,h.__N=void 0,u!==h.__[0]&&(a=!0)}}),i&&i.call(this,d,l,_)||a};w.__f=!0;var i=w.shouldComponentUpdate,o=w.componentWillUpdate;w.componentWillUpdate=function(d,l,_){if(this.__e){var p=i;i=void 0,c(d,l,_),i=p}o&&o.call(this,d,l,_)},w.shouldComponentUpdate=c}return s.__N||s.__}function nn(n,t){var r=le(q++,3);!C.__s&&Ie(r.__H,t)&&(r.__=n,r.u=t,w.__H.__h.push(r))}function tn(n){return G=5,sn(function(){return{current:n}},[])}function sn(n,t){var r=le(q++,7);return Ie(r.__H,t)&&(r.__=n(),r.__H=t,r.__h=n),r.__}function rn(){for(var n;n=Me.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(j),n.__H.__h.forEach(re),n.__H.__h=[]}catch(t){n.__H.__h=[],C.__e(t,n.__v)}}C.__b=function(n){w=null,fe&&fe(n)},C.__=function(n,t){n&&t.__k&&t.__k.__m&&(n.__m=t.__k.__m),ke&&ke(n,t)},C.__r=function(n){me&&me(n),q=0;var t=(w=n.__c).__H;t&&(Z===w?(t.__h=[],w.__h=[],t.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(t.__h.forEach(j),t.__h.forEach(re),t.__h=[],q=0)),Z=w},C.diffed=function(n){ge&&ge(n);var t=n.__c;t&&t.__H&&(t.__H.__h.length&&(Me.push(t)!==1&&pe===C.requestAnimationFrame||((pe=C.requestAnimationFrame)||cn)(rn)),t.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),Z=w=null},C.__c=function(n,t){t.some(function(r){try{r.__h.forEach(j),r.__h=r.__h.filter(function(s){return!s.__||re(s)})}catch(s){t.some(function(c){c.__h&&(c.__h=[])}),t=[],C.__e(s,r.__v)}}),ve&&ve(n,t)},C.unmount=function(n){ye&&ye(n);var t,r=n.__c;r&&r.__H&&(r.__H.__.forEach(function(s){try{j(s)}catch(c){t=c}}),r.__H=void 0,t&&C.__e(t,r.__v))};var be=typeof requestAnimationFrame=="function";function cn(n){var t,r=function(){clearTimeout(s),be&&cancelAnimationFrame(t),setTimeout(n)},s=setTimeout(r,35);be&&(t=requestAnimationFrame(r))}function j(n){var t=w,r=n.__c;typeof r=="function"&&(n.__c=void 0,r()),w=t}function re(n){var t=w;n.__c=n.__(),w=t}function Ie(n,t){return!n||n.length!==t.length||t.some(function(r,s){return r!==n[s]})}function Oe(n,t){return typeof t=="function"?t(n):t}async function we(){const n=await fetch("/api/dumps");if(!n.ok)throw new Error(`fetch failed: ${n.status}`);return n.json()}function on(n){const r=`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}/api/ws`,s=new WebSocket(r);return s.onmessage=c=>{try{const i=JSON.parse(c.data);n.onDumps(i)}catch(i){n.onError(`WebSocket parse error: ${i}`)}},s.onerror=()=>{n.onError("WebSocket error")},s.onclose=()=>{n.onClose()},()=>{s.close()}}function an({dumps:n,filter:t,onFilter:r,onRefresh:s,error:c}){const i=n.reduce((d,l)=>d+l.tasks.length,0),o=n.reduce((d,l)=>d+l.threads.length,0);return e("div",{class:"header",children:[e("div",{class:"header-brand",children:[e("span",{class:"accent",children:"peeps"})," dashboard"]}),e("div",{class:"header-sep"}),e("div",{class:"header-stats",children:[e("span",{children:[e("span",{class:"val",children:n.length})," processes"]}),e("span",{children:[e("span",{class:"val",children:i})," tasks"]}),e("span",{children:[e("span",{class:"val",children:o})," threads"]})]}),e("div",{class:"header-spacer"}),c&&e("span",{class:"header-error",children:c}),e("input",{class:"search-box",type:"text",placeholder:"Filter...",autocomplete:"off",spellcheck:!1,value:t,onInput:d=>r(d.target.value)}),e("button",{class:"expand-trigger",style:"padding: 5px 12px; font-size: 12px",onClick:s,children:"Refresh"})]})}function R(n){return n==null?"—":n<1024?n+" B":n<1048576?(n/1024).toFixed(1)+" KB":n<1073741824?(n/1048576).toFixed(1)+" MB":(n/1073741824).toFixed(2)+" GB"}function v(n){return n>=60?(n/60).toFixed(1)+"m":n>=1?n.toFixed(2)+"s":(n*1e3).toFixed(0)+"ms"}function $(n){return n>=3600?(n/3600).toFixed(1)+"h":n>=60?(n/60).toFixed(1)+"m":n.toFixed(1)+"s"}const Be=["std::backtrace","std::sys","backtrace_rs","backtrace::","vx_dump::thread_stacks::sigprof_handler","peeps_threads::imp::sigprof_handler","__os_lock","_pthread_","pthread_","tokio::runtime::park","tokio::runtime::context","tokio::runtime::scheduler","tokio::runtime::runtime","tokio::runtime::blocking","core::ops::function","std::panicking","std::panic","std::rt::lang_start","<unknown>","tokio::park","mio::poll"],De=["parking_lot_core::thread_parker","parking_lot_core::parking_lot::park","parking_lot::condvar::Condvar::wait","parking_lot::condvar::Condvar::wait_until_internal","tokio::runtime::park::","tokio::park","mio::poll","epoll_wait","kevent"];function We(n){if(!n)return null;for(const t of n.split(`
`)){const r=t.trim().match(/^\d+:\s+(.+)/);if(!r)continue;const s=r[1].split(`
`)[0].trim();if(!Be.some(c=>s.startsWith(c)))return s}return null}function ln(n){if(!n)return!1;for(const t of n.split(`
`)){const r=t.trim().match(/^\d+:\s+(.+)/);if(!r)continue;const s=r[1].split(`
`)[0].trim();if(!Be.some(c=>s.startsWith(c)))return!!De.some(c=>s.includes(c))}return!1}function dn(n){return n?De.some(t=>n.includes(t)):!1}function L(...n){return n.filter(Boolean).join(" ")}function _n(n){return n.some(t=>t.severity==="danger")}function qe(n){const t=[];for(const r of n){const s=r.process_name;hn(s,r,t),un(s,r,t),fn(s,r,t),mn(s,r,t),gn(s,r,t),vn(s,r,t)}return t.sort((r,s)=>r.severity!==s.severity?r.severity==="danger"?-1:1:s.timing-r.timing),t}function hn(n,t,r){for(const s of t.tasks)if(s.state==="Polling"&&s.poll_events.length>0){const c=s.poll_events[s.poll_events.length-1];c.duration_secs!=null&&c.duration_secs>1?r.push({severity:"danger",category:"Tasks",process:n,resource:s.name,description:`Polling for ${v(c.duration_secs)}`,timing:c.duration_secs,timingLabel:v(c.duration_secs),backtrace:c.backtrace??s.spawn_backtrace}):c.duration_secs!=null&&c.duration_secs>.1&&r.push({severity:"warn",category:"Tasks",process:n,resource:s.name,description:`Polling for ${v(c.duration_secs)}`,timing:c.duration_secs,timingLabel:v(c.duration_secs),backtrace:c.backtrace??s.spawn_backtrace})}else s.state==="Pending"&&s.age_secs>30&&s.poll_events.length===0&&r.push({severity:"warn",category:"Tasks",process:n,resource:s.name,description:`Pending for ${$(s.age_secs)}, never polled`,timing:s.age_secs,timingLabel:$(s.age_secs),backtrace:s.spawn_backtrace})}function un(n,t,r){for(const s of t.threads){const c=s.dominant_frame??We(s.backtrace);dn(c)||ln(s.backtrace)||(s.same_location_count>=10?r.push({severity:"danger",category:"Threads",process:n,resource:s.name,description:`Stuck at same location for ${s.same_location_count} samples`,timing:s.same_location_count,timingLabel:`${s.same_location_count} samples stuck`,backtrace:s.backtrace}):s.same_location_count>=5&&r.push({severity:"warn",category:"Threads",process:n,resource:s.name,description:`Same location for ${s.same_location_count} samples`,timing:s.same_location_count,timingLabel:`${s.same_location_count} samples stuck`,backtrace:s.backtrace}))}}function Ue(n){const t=new Map,r=c=>{const i=[c.severity,c.category,c.process,c.blocked,c.waitsOn,c.owner??""].join("|"),o=t.get(i);o?(o.count+=1,c.timing>o.timing&&(o.timing=c.timing,o.timingLabel=c.timingLabel),!o.backtrace&&c.backtrace&&(o.backtrace=c.backtrace)):t.set(i,{...c,count:1})};for(const c of n){const i=c.process_name;if(c.locks)for(const o of c.locks.locks){const d=o.holders.map(_=>_.task_name).filter(_=>!!_&&_.trim().length>0),l=d.length>0?d[0]:null;for(const _ of o.waiters)_.waiting_secs<=1||r({severity:_.waiting_secs>5?"danger":"warn",category:"Locks",process:i,blocked:_.task_name??`${i}:${o.name}:waiter`,waitsOn:`lock:${o.name}`,owner:l,description:`Lock waiter blocked for ${v(_.waiting_secs)}`,timing:_.waiting_secs,timingLabel:v(_.waiting_secs),backtrace:_.backtrace})}if(c.sync)for(const o of c.sync.mpsc_channels)o.send_waiters<=0||r({severity:o.send_waiters>3?"danger":"warn",category:"Channels",process:i,blocked:`${o.send_waiters} sender(s)`,waitsOn:`channel:${o.name}`,owner:o.creator_task_name??null,description:`Backpressure on channel (${o.send_waiters} blocked sender(s))`,timing:o.age_secs,timingLabel:$(o.age_secs),backtrace:null});if(c.roam)for(const o of c.roam.connections)for(const d of o.in_flight){if(d.elapsed_secs<=2)continue;const l=d.method_name??`method#${d.method_id}`;r({severity:d.elapsed_secs>10?"danger":"warn",category:"RPC",process:i,blocked:`${o.name} (${l})`,waitsOn:`rpc:${o.peer_name??"unknown-peer"}`,owner:o.peer_name??null,description:`RPC in-flight for ${v(d.elapsed_secs)}`,timing:d.elapsed_secs,timingLabel:v(d.elapsed_secs),backtrace:d.backtrace})}}const s=[...t.values()];return s.sort((c,i)=>c.severity!==i.severity?c.severity==="danger"?-1:1:i.count!==c.count?i.count-c.count:i.timing-c.timing),s}function pn(n){const t=new Map;for(const s of n){const c=s.owner??s.waitsOn,i=t.get(c);i?(i.edgeCount+=s.count,i.blockedCount+=1,s.severity==="danger"&&(i.severity="danger"),s.timing>i.worstTiming&&(i.worstTiming=s.timing,i.worstTimingLabel=s.timingLabel)):t.set(c,{severity:s.severity,owner:c,blockedCount:1,edgeCount:s.count,worstTiming:s.timing,worstTimingLabel:s.timingLabel})}const r=[...t.values()];return r.sort((s,c)=>s.severity!==c.severity?s.severity==="danger"?-1:1:c.blockedCount!==s.blockedCount?c.blockedCount-s.blockedCount:c.edgeCount!==s.edgeCount?c.edgeCount-s.edgeCount:c.worstTiming-s.worstTiming),r}function fn(n,t,r){if(t.locks)for(const s of t.locks.locks){for(const c of s.holders)c.held_secs>5?r.push({severity:"danger",category:"Locks",process:n,resource:s.name,description:`Held for ${v(c.held_secs)} (${c.kind})`,timing:c.held_secs,timingLabel:v(c.held_secs),backtrace:c.backtrace}):c.held_secs>1&&r.push({severity:"warn",category:"Locks",process:n,resource:s.name,description:`Held for ${v(c.held_secs)} (${c.kind})`,timing:c.held_secs,timingLabel:v(c.held_secs),backtrace:c.backtrace});for(const c of s.waiters)c.waiting_secs>5?r.push({severity:"danger",category:"Locks",process:n,resource:s.name,description:`Waiting for ${v(c.waiting_secs)} (${c.kind})`,timing:c.waiting_secs,timingLabel:v(c.waiting_secs),backtrace:c.backtrace}):c.waiting_secs>1&&r.push({severity:"warn",category:"Locks",process:n,resource:s.name,description:`Waiting for ${v(c.waiting_secs)} (${c.kind})`,timing:c.waiting_secs,timingLabel:v(c.waiting_secs),backtrace:c.backtrace})}}function mn(n,t,r){if(t.sync){for(const s of t.sync.mpsc_channels)if(s.send_waiters>0&&s.receiver_closed)r.push({severity:"danger",category:"Channels",process:n,resource:s.name,description:`${s.send_waiters} blocked sender(s), receiver closed`,timing:s.age_secs,timingLabel:$(s.age_secs),backtrace:null});else if(s.sender_closed||s.receiver_closed){const c=s.sender_closed?"sender":"receiver";r.push({severity:"danger",category:"Channels",process:n,resource:s.name,description:`Broken pipe: ${c} closed`,timing:s.age_secs,timingLabel:$(s.age_secs),backtrace:null})}else s.send_waiters>0&&r.push({severity:"warn",category:"Channels",process:n,resource:s.name,description:`${s.send_waiters} sender(s) blocked (backpressure)`,timing:s.age_secs,timingLabel:$(s.age_secs),backtrace:null});for(const s of t.sync.oneshot_channels)s.state==="SenderDropped"||s.state==="ReceiverDropped"?r.push({severity:"danger",category:"Channels",process:n,resource:s.name,description:`Oneshot: ${s.state}`,timing:s.age_secs,timingLabel:$(s.age_secs),backtrace:null}):s.state==="Pending"&&s.age_secs>10&&r.push({severity:"warn",category:"Channels",process:n,resource:s.name,description:`Oneshot pending for ${$(s.age_secs)}`,timing:s.age_secs,timingLabel:$(s.age_secs),backtrace:null});for(const s of t.sync.once_cells)s.state==="Initializing"&&s.age_secs>5&&r.push({severity:"warn",category:"Channels",process:n,resource:s.name,description:`OnceCell initializing for ${$(s.age_secs)}`,timing:s.age_secs,timingLabel:$(s.age_secs),backtrace:null})}}function gn(n,t,r){if(t.roam)for(const s of t.roam.connections)for(const c of s.in_flight){const i=c.method_name??`method#${c.method_id}`;c.elapsed_secs>10?r.push({severity:"danger",category:"RPC",process:n,resource:`${s.name}: ${i}`,description:`In-flight for ${v(c.elapsed_secs)}`,timing:c.elapsed_secs,timingLabel:v(c.elapsed_secs),backtrace:c.backtrace}):c.elapsed_secs>2&&r.push({severity:"warn",category:"RPC",process:n,resource:`${s.name}: ${i}`,description:`In-flight for ${v(c.elapsed_secs)}`,timing:c.elapsed_secs,timingLabel:v(c.elapsed_secs),backtrace:c.backtrace})}}function vn(n,t,r){if(t.shm){for(const s of t.shm.segments)for(const c of s.peers){if(c.state!=="Attached")continue;const i=c.name??`peer#${c.peer_id}`;c.time_since_heartbeat_ms!=null&&c.time_since_heartbeat_ms>5e3?r.push({severity:"danger",category:"SHM",process:n,resource:i,description:`No heartbeat for ${(c.time_since_heartbeat_ms/1e3).toFixed(1)}s`,timing:c.time_since_heartbeat_ms/1e3,timingLabel:v(c.time_since_heartbeat_ms/1e3),backtrace:null}):c.time_since_heartbeat_ms!=null&&c.time_since_heartbeat_ms>2e3&&r.push({severity:"warn",category:"SHM",process:n,resource:i,description:`No heartbeat for ${(c.time_since_heartbeat_ms/1e3).toFixed(1)}s`,timing:c.time_since_heartbeat_ms/1e3,timingLabel:v(c.time_since_heartbeat_ms/1e3),backtrace:null})}for(const s of t.shm.channels)s.len===s.capacity&&s.capacity>0&&r.push({severity:"warn",category:"SHM",process:n,resource:s.name,description:`Queue full (${s.len}/${s.capacity})`,timing:s.capacity,timingLabel:`${s.len}/${s.capacity}`,backtrace:null})}}function yn(n,t){switch(n){case"problems":return null;case"tasks":return t.reduce((r,s)=>r+s.tasks.length,0);case"threads":return t.reduce((r,s)=>r+s.threads.length,0);case"locks":return t.reduce((r,s)=>{var c;return r+(((c=s.locks)==null?void 0:c.locks.length)??0)},0);case"sync":{let r=0;for(const s of t)s.sync&&(r+=s.sync.mpsc_channels.length+s.sync.oneshot_channels.length+s.sync.watch_channels.length+s.sync.once_cells.length);return r}case"requests":return t.reduce((r,s)=>{var c;return r+(((c=s.roam)==null?void 0:c.connections.reduce((i,o)=>i+o.in_flight.length,0))??0)},0);case"connections":return t.reduce((r,s)=>{var c;return r+(((c=s.roam)==null?void 0:c.connections.length)??0)},0);case"processes":return t.length;case"shm":return null}}const Ce={problems:"Problems",tasks:"Tasks",threads:"Threads",locks:"Locks",sync:"Sync",requests:"Requests",connections:"Connections",processes:"Processes",shm:"SHM"};function kn({tabs:n,active:t,onSelect:r,dumps:s}){const c=qe(s),i=Ue(s),o=c.length+i.length,d=_n(c)||i.some(l=>l.severity==="danger");return e("div",{class:"tab-bar",children:n.map(l=>{if(l==="problems")return e("div",{class:L("tab",l===t&&"active"),onClick:()=>r(l),children:[Ce[l],o>0&&e("span",{class:L("tab-badge",d?"tab-badge-danger":"tab-badge-warn"),children:o})]},l);const _=yn(l,s);return e("div",{class:L("tab",l===t&&"active"),onClick:()=>r(l),children:[Ce[l],_!=null&&e("span",{class:"tab-badge",children:_})]},l)})})}function A({label:n="trace",content:t}){const[r,s]=I(!1);return t?e(B,{children:[e("span",{class:"expand-trigger",onClick:()=>s(!r),children:n}),r&&e("div",{class:"expandable-content open",children:t})]}):e("span",{class:"muted",children:"—"})}function ze(n){switch(n){case"Polling":return"state-polling";case"Completed":return"state-completed";default:return"state-pending"}}function bn(n){if(n.state==="Polling"){const t=n.poll_events[n.poll_events.length-1];if((t==null?void 0:t.duration_secs)!=null&&t.duration_secs>1)return"severity-danger";if((t==null?void 0:t.duration_secs)!=null&&t.duration_secs>.1)return"severity-warn"}return""}function wn(n,t){var s;if(!t)return!0;const r=t.toLowerCase();return n.name.toLowerCase().includes(r)||n.process.toLowerCase().includes(r)||n.state.toLowerCase().includes(r)||(((s=n.parent_task_name)==null?void 0:s.toLowerCase().includes(r))??!1)||String(n.id).includes(r)}function Cn({dumps:n,filter:t}){const[r,s]=I("table"),c=[];for(const o of n)for(const d of o.tasks)c.push({...d,process:o.process_name,pid:o.pid});const i=c.filter(o=>wn(o,t));return c.length===0?e("div",{class:"empty-state fade-in",children:[e("div",{class:"icon",children:"T"}),e("p",{children:"No tasks tracked"}),e("p",{class:"sub",children:"Tasks appear when using peeps::tasks::spawn_tracked()"})]}):e("div",{class:"fade-in",children:[e("div",{style:"margin-bottom: 12px; display: flex; gap: 8px",children:[e("button",{class:L("expand-trigger",r==="table"&&"active"),style:"padding: 4px 10px",onClick:()=>s("table"),children:"Table"}),e("button",{class:L("expand-trigger",r==="tree"&&"active"),style:"padding: 4px 10px",onClick:()=>s("tree"),children:"Tree"})]}),r==="table"?e(Ln,{tasks:i}):e($n,{tasks:i})]})}function Ln({tasks:n}){return e("div",{class:"card",children:e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"ID"}),e("th",{children:"Process"}),e("th",{children:"Name"}),e("th",{children:"State"}),e("th",{children:"Age"}),e("th",{children:"Parent"}),e("th",{children:"Polls"}),e("th",{children:"Last Poll"}),e("th",{children:"Backtrace"})]})}),e("tbody",{children:n.map(t=>e("tr",{class:bn(t),children:[e("td",{class:"mono",children:["#",t.id]}),e("td",{class:"mono",children:t.process}),e("td",{class:"mono",children:t.name}),e("td",{children:e("span",{class:L("state-badge",ze(t.state)),children:t.state})}),e("td",{class:"num",children:$(t.age_secs)}),e("td",{class:"mono",children:t.parent_task_id!=null?e("span",{children:[t.parent_task_name??""," (#",t.parent_task_id,")"]}):e("span",{class:"muted",children:"—"})}),e("td",{class:"num",children:t.poll_events.length}),e("td",{class:"num",children:t.poll_events.length>0?v(t.poll_events[t.poll_events.length-1].duration_secs??0):"—"}),e("td",{children:e(A,{content:t.spawn_backtrace||null})})]},`${t.pid}-${t.id}`))})]})})}function $n({tasks:n}){const t=new Map;for(const c of n)t.set(c.id,c);const r=n.filter(c=>c.parent_task_id==null||!t.has(c.parent_task_id)),s=new Map;for(const c of n)if(c.parent_task_id!=null&&t.has(c.parent_task_id)){const i=s.get(c.parent_task_id)??[];i.push(c),s.set(c.parent_task_id,i)}return e("div",{children:r.map(c=>e(Ve,{task:c,children:s,depth:0},c.id))})}function Ve({task:n,children:t,depth:r}){const s=t.get(n.id)??[];return e("div",{class:r===0?"tree-node-root":"tree-node",children:[e("div",{class:"tree-item",children:[e("span",{class:L("state-badge",ze(n.state)),style:"margin-right: 6px",children:n.state}),e("span",{class:"mono",children:["#",n.id," ",n.name]}),e("span",{class:"muted",style:"margin-left: 8px",children:[n.process," · ",$(n.age_secs)]})]}),s.map(c=>e(Ve,{task:c,children:t,depth:r+1},c.id))]})}function Tn(n){return n.same_location_count>=10?"severity-danger":n.same_location_count>=5?"severity-warn":""}function Sn({dumps:n,filter:t}){const r=[];for(const i of n)for(const o of i.threads)r.push({...o,process:i.process_name});const s=t.toLowerCase(),c=r.filter(i=>{var o;return!s||i.name.toLowerCase().includes(s)||i.process.toLowerCase().includes(s)||(((o=i.dominant_frame)==null?void 0:o.toLowerCase().includes(s))??!1)});return r.length===0?e("div",{class:"empty-state fade-in",children:[e("div",{class:"icon",children:"T"}),e("p",{children:"No thread data"})]}):e("div",{class:"card fade-in",children:e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Process"}),e("th",{children:"Thread"}),e("th",{children:"Samples"}),e("th",{children:"Responded"}),e("th",{children:"Stuck"}),e("th",{children:"Top Frame"}),e("th",{children:"Backtrace"})]})}),e("tbody",{children:c.map((i,o)=>e("tr",{class:Tn(i),children:[e("td",{class:"mono",children:i.process}),e("td",{class:"mono",children:i.name}),e("td",{class:"num",children:i.samples}),e("td",{class:"num",children:i.responded}),e("td",{class:L("num",i.same_location_count>=5&&"text-red"),children:i.same_location_count}),e("td",{class:"mono",style:"max-width:400px;overflow:hidden;text-overflow:ellipsis",children:i.dominant_frame??We(i.backtrace)??e("span",{class:"muted",children:"—"})}),e("td",{children:e(A,{content:i.backtrace})})]},o))})]})})}function xn({dumps:n,filter:t}){const r=[];for(const i of n)if(i.locks)for(const o of i.locks.locks)r.push({...o,process:i.process_name});const s=t.toLowerCase(),c=r.filter(i=>!s||i.name.toLowerCase().includes(s)||i.process.toLowerCase().includes(s));return r.length===0?e("div",{class:"empty-state fade-in",children:[e("div",{class:"icon",children:"L"}),e("p",{children:"No contended locks"})]}):e("div",{class:"fade-in",children:c.map((i,o)=>e("div",{class:"card",children:[e("div",{class:"card-head",children:[e("span",{class:"mono",children:i.process}),e("span",{class:"muted",children:"/"}),e("span",{class:"mono",children:i.name}),e("span",{class:"muted",style:"margin-left: auto",children:[i.acquires," acquires, ",i.releases," releases"]})]}),i.holders.length>0&&e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Holder"}),e("th",{children:"Kind"}),e("th",{children:"Held"}),e("th",{children:"Task"}),e("th",{children:"Backtrace"})]})}),e("tbody",{children:i.holders.map((d,l)=>e("tr",{children:[e("td",{class:"mono",children:["holder #",l]}),e("td",{class:"mono",children:d.kind}),e("td",{class:"num",children:v(d.held_secs)}),e("td",{class:"mono",children:d.task_id!=null?e("span",{children:[d.task_name??""," (#",d.task_id,")"]}):e("span",{class:"muted",children:"—"})}),e("td",{children:e(A,{content:d.backtrace})})]},l))})]}),i.waiters.length>0&&e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Waiter"}),e("th",{children:"Kind"}),e("th",{children:"Waiting"}),e("th",{children:"Task"}),e("th",{children:"Backtrace"})]})}),e("tbody",{children:i.waiters.map((d,l)=>e("tr",{class:d.waiting_secs>1?"severity-warn":"",children:[e("td",{class:"mono",children:["waiter #",l]}),e("td",{class:"mono",children:d.kind}),e("td",{class:"num",children:v(d.waiting_secs)}),e("td",{class:"mono",children:d.task_id!=null?e("span",{children:[d.task_name??""," (#",d.task_id,")"]}):e("span",{class:"muted",children:"—"})}),e("td",{children:e(A,{content:d.backtrace})})]},l))})]})]},o))})}function Le(n){switch(n){case"Pending":return"state-pending";case"Sent":case"Received":case"Initialized":return"state-completed";case"Initializing":return"state-initializing";case"SenderDropped":case"ReceiverDropped":return"state-dropped";case"Empty":return"state-empty";default:return""}}function ee(n,t){return n==null?e("span",{class:"muted",children:"—"}):e("span",{class:"mono",children:[t??""," (#",n,")"]})}function Pn({dumps:n,filter:t}){const r=t.toLowerCase(),s=[],c=[],i=[],o=[];for(const l of n)if(l.sync){for(const _ of l.sync.mpsc_channels)s.push({process:l.process_name,ch:_});for(const _ of l.sync.oneshot_channels)c.push({process:l.process_name,ch:_});for(const _ of l.sync.watch_channels)i.push({process:l.process_name,ch:_});for(const _ of l.sync.once_cells)o.push({process:l.process_name,ch:_})}const d=(l,_)=>!r||l.toLowerCase().includes(r)||_.toLowerCase().includes(r);return e("div",{class:"fade-in",children:[s.length>0&&e("div",{class:"card",style:"margin-bottom: 16px",children:[e("div",{class:"card-head",children:"MPSC Channels"}),e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Process"}),e("th",{children:"Name"}),e("th",{children:"Type"}),e("th",{children:"Sent"}),e("th",{children:"Recv"}),e("th",{children:"Senders"}),e("th",{children:"Waiters"}),e("th",{children:"Age"}),e("th",{children:"Creator"})]})}),e("tbody",{children:s.filter(l=>d(l.process,l.ch.name)).map((l,_)=>e("tr",{class:L(l.ch.send_waiters>0&&"severity-warn",(l.ch.sender_closed||l.ch.receiver_closed)&&"severity-danger"),children:[e("td",{class:"mono",children:l.process}),e("td",{class:"mono",children:l.ch.name}),e("td",{class:"mono",children:l.ch.bounded?`bounded(${l.ch.capacity})`:"unbounded"}),e("td",{class:"num",children:l.ch.sent}),e("td",{class:"num",children:l.ch.received}),e("td",{class:"num",children:l.ch.sender_count}),e("td",{class:L("num",l.ch.send_waiters>0&&"text-amber"),children:l.ch.send_waiters}),e("td",{class:"num",children:$(l.ch.age_secs)}),e("td",{children:ee(l.ch.creator_task_id,l.ch.creator_task_name)})]},_))})]})]}),c.length>0&&e("div",{class:"card",style:"margin-bottom: 16px",children:[e("div",{class:"card-head",children:"Oneshot Channels"}),e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Process"}),e("th",{children:"Name"}),e("th",{children:"State"}),e("th",{children:"Age"}),e("th",{children:"Creator"})]})}),e("tbody",{children:c.filter(l=>d(l.process,l.ch.name)).map((l,_)=>e("tr",{children:[e("td",{class:"mono",children:l.process}),e("td",{class:"mono",children:l.ch.name}),e("td",{children:e("span",{class:L("state-badge",Le(l.ch.state)),children:l.ch.state})}),e("td",{class:"num",children:$(l.ch.age_secs)}),e("td",{children:ee(l.ch.creator_task_id,l.ch.creator_task_name)})]},_))})]})]}),i.length>0&&e("div",{class:"card",style:"margin-bottom: 16px",children:[e("div",{class:"card-head",children:"Watch Channels"}),e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Process"}),e("th",{children:"Name"}),e("th",{children:"Changes"}),e("th",{children:"Receivers"}),e("th",{children:"Age"}),e("th",{children:"Creator"})]})}),e("tbody",{children:i.filter(l=>d(l.process,l.ch.name)).map((l,_)=>e("tr",{children:[e("td",{class:"mono",children:l.process}),e("td",{class:"mono",children:l.ch.name}),e("td",{class:"num",children:l.ch.changes}),e("td",{class:"num",children:l.ch.receiver_count}),e("td",{class:"num",children:$(l.ch.age_secs)}),e("td",{children:ee(l.ch.creator_task_id,l.ch.creator_task_name)})]},_))})]})]}),o.length>0&&e("div",{class:"card",children:[e("div",{class:"card-head",children:"OnceCells"}),e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Process"}),e("th",{children:"Name"}),e("th",{children:"State"}),e("th",{children:"Age"}),e("th",{children:"Init Duration"})]})}),e("tbody",{children:o.filter(l=>d(l.process,l.ch.name)).map((l,_)=>e("tr",{children:[e("td",{class:"mono",children:l.process}),e("td",{class:"mono",children:l.ch.name}),e("td",{children:e("span",{class:L("state-badge",Le(l.ch.state)),children:l.ch.state})}),e("td",{class:"num",children:$(l.ch.age_secs)}),e("td",{class:"num",children:l.ch.init_duration_secs!=null?(l.ch.init_duration_secs*1e3).toFixed(0)+"ms":"—"})]},_))})]})]})]})}function Nn({dumps:n,filter:t}){const r=t.toLowerCase(),s=n.filter(c=>!r||c.process_name.toLowerCase().includes(r));return n.length===0?e("div",{class:"empty-state fade-in",children:[e("div",{class:"icon",children:"P"}),e("p",{children:"No processes"}),e("p",{class:"sub",children:"Waiting for instrumented processes to connect..."})]}):e("div",{class:"card-grid fade-in",children:s.map(c=>e(Rn,{dump:c},`${c.process_name}-${c.pid}`))})}function Rn({dump:n}){var o,d,l,_,p;const t=((o=n.roam)==null?void 0:o.connections.length)??0,r=((d=n.roam)==null?void 0:d.connections.reduce((a,h)=>a+h.in_flight.length,0))??0,s=((l=n.roam)==null?void 0:l.connections.reduce((a,h)=>a+h.total_completed,0))??0,c=((_=n.roam)==null?void 0:_.connections.reduce((a,h)=>a+h.transport.bytes_sent,0))??0,i=((p=n.roam)==null?void 0:p.connections.reduce((a,h)=>a+h.transport.bytes_received,0))??0;return e("div",{class:"proc-card",children:[e("div",{class:"proc-card-head",children:[e("div",{class:"dot",style:"background: var(--purple)"}),e("div",{class:"name",children:n.process_name}),e("div",{class:"pid",children:["pid ",n.pid]})]}),e("div",{class:"proc-card-body",children:[e("div",{class:"proc-kv",children:[e("div",{class:"proc-kv-item",children:[e("span",{class:"k",children:"Tasks"}),e("span",{class:"v",children:n.tasks.length})]}),e("div",{class:"proc-kv-item",children:[e("span",{class:"k",children:"Threads"}),e("span",{class:"v",children:n.threads.length})]}),t>0&&e(B,{children:[e("div",{class:"proc-kv-item",children:[e("span",{class:"k",children:"Connections"}),e("span",{class:"v",children:t})]}),e("div",{class:"proc-kv-item",children:[e("span",{class:"k",children:"In-flight"}),e("span",{class:"v",children:r})]}),e("div",{class:"proc-kv-item",children:[e("span",{class:"k",children:"Completed"}),e("span",{class:"v",children:s})]}),e("div",{class:"proc-kv-item",children:[e("span",{class:"k",children:"TX / RX"}),e("span",{class:"v",children:[R(c)," / ",R(i)]})]})]}),n.locks&&e("div",{class:"proc-kv-item",children:[e("span",{class:"k",children:"Contended locks"}),e("span",{class:"v",children:n.locks.locks.length})]})]}),e("div",{class:"proc-section",style:"font-size: 11px; color: var(--fg-muted)",children:["Timestamp: ",n.timestamp]})]})]})}function En({dumps:n,filter:t}){const r=[];for(const i of n)if(i.roam)for(const o of i.roam.connections)r.push({...o,process:i.process_name});const s=t.toLowerCase(),c=r.filter(i=>{var o;return!s||i.process.toLowerCase().includes(s)||i.name.toLowerCase().includes(s)||(((o=i.peer_name)==null?void 0:o.toLowerCase().includes(s))??!1)});return r.length===0?e("div",{class:"empty-state fade-in",children:[e("div",{class:"icon",children:"C"}),e("p",{children:"No connections"})]}):e("div",{class:"card fade-in",children:e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Process"}),e("th",{children:"Name"}),e("th",{children:"Peer"}),e("th",{children:"Age"}),e("th",{children:"In-Flight"}),e("th",{children:"Completed"}),e("th",{children:"Channels"}),e("th",{children:"TX"}),e("th",{children:"RX"}),e("th",{children:"Last Activity"})]})}),e("tbody",{children:c.map((i,o)=>e("tr",{children:[e("td",{class:"mono",children:i.process}),e("td",{class:"mono",children:i.name}),e("td",{class:"mono",children:i.peer_name??e("span",{class:"muted",children:"?"})}),e("td",{class:"num",children:$(i.age_secs)}),e("td",{class:"num",children:i.in_flight.length}),e("td",{class:"num",children:i.total_completed}),e("td",{class:"num",children:i.channels.length}),e("td",{class:"num",children:[R(i.transport.bytes_sent),e("span",{class:"muted",children:[" (",i.transport.frames_sent,"f)"]})]}),e("td",{class:"num",children:[R(i.transport.bytes_received),e("span",{class:"muted",children:[" (",i.transport.frames_received,"f)"]})]}),e("td",{class:"num",children:i.transport.last_recv_ago_secs!=null?v(i.transport.last_recv_ago_secs)+" ago":"—"})]},o))})]})})}function Fn(n){return n.elapsed_secs>10?"severity-danger":n.elapsed_secs>2?"severity-warn":""}function Hn({dumps:n,filter:t}){const r=[];for(const i of n)if(i.roam)for(const o of i.roam.connections)for(const d of o.in_flight)r.push({...d,process:i.process_name,connection:o.name,peer:o.peer_name??"?"});r.sort((i,o)=>o.elapsed_secs-i.elapsed_secs);const s=t.toLowerCase(),c=r.filter(i=>{var o;return!s||i.process.toLowerCase().includes(s)||(((o=i.method_name)==null?void 0:o.toLowerCase().includes(s))??!1)||i.connection.toLowerCase().includes(s)||i.peer.toLowerCase().includes(s)});return r.length===0?e("div",{class:"empty-state fade-in",children:[e("div",{class:"icon",children:"R"}),e("p",{children:"No in-flight requests"})]}):e("div",{class:"card fade-in",children:e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Dir"}),e("th",{children:"Process"}),e("th",{children:"Method"}),e("th",{children:"Elapsed"}),e("th",{children:"Connection"}),e("th",{children:"Peer"}),e("th",{children:"Request ID"}),e("th",{children:"Backtrace"})]})}),e("tbody",{children:c.map((i,o)=>e("tr",{class:Fn(i),children:[e("td",{children:e("span",{class:L("dir",i.direction==="Outgoing"?"dir-out":"dir-in"),children:i.direction==="Outgoing"?"→":"←"})}),e("td",{class:"mono",children:i.process}),e("td",{class:"mono",children:i.method_name??`method_${i.method_id}`}),e("td",{class:"num",children:v(i.elapsed_secs)}),e("td",{class:"mono",children:i.connection}),e("td",{class:"mono",children:i.peer}),e("td",{class:"num",children:i.request_id}),e("td",{children:e(A,{content:i.backtrace})})]},o))})]})})}function An({dumps:n,filter:t}){const r=t.toLowerCase(),s=[];for(const i of n)if(i.shm)for(const o of i.shm.segments)s.push({process:i.process_name,seg:o});const c=s.filter(i=>{var o;return!r||i.process.toLowerCase().includes(r)||(((o=i.seg.segment_path)==null?void 0:o.toLowerCase().includes(r))??!1)});return s.length===0?e("div",{class:"empty-state fade-in",children:[e("div",{class:"icon",children:"S"}),e("p",{children:"No SHM segments"})]}):e("div",{class:"fade-in",children:c.map((i,o)=>e("div",{class:"card",style:"margin-bottom: 16px",children:[e("div",{class:"card-head",children:[e("span",{class:"mono",children:i.process}),e("span",{class:"muted",children:"/"}),e("span",{class:"mono",children:i.seg.segment_path??"anonymous"}),e("span",{class:"muted",style:"margin-left: auto",children:[R(i.seg.current_size)," / ",R(i.seg.total_size)]})]}),e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Peer"}),e("th",{children:"Name"}),e("th",{children:"State"}),e("th",{children:"Buf Cap"}),e("th",{children:"TX"}),e("th",{children:"RX"}),e("th",{children:"Calls TX"}),e("th",{children:"Calls RX"}),e("th",{children:"Heartbeat"})]})}),e("tbody",{children:i.seg.peers.map(d=>e("tr",{children:[e("td",{class:"num",children:d.peer_id}),e("td",{class:"mono",children:d.name??e("span",{class:"muted",children:"—"})}),e("td",{class:"mono",children:d.state}),e("td",{class:"num",children:R(d.bipbuf_capacity)}),e("td",{class:"num",children:R(d.bytes_sent)}),e("td",{class:"num",children:R(d.bytes_received)}),e("td",{class:"num",children:d.calls_sent}),e("td",{class:"num",children:d.calls_received}),e("td",{class:"num",children:d.time_since_heartbeat_ms!=null?d.time_since_heartbeat_ms+"ms":"—"})]},d.peer_id))})]})]},o))})}const Mn=["Tasks","Threads","Locks","Channels","RPC","SHM"];function In(n,t){return n.process.toLowerCase().includes(t)||n.resource.toLowerCase().includes(t)||n.description.toLowerCase().includes(t)||n.category.toLowerCase().includes(t)}function On(n,t){var r;return n.process.toLowerCase().includes(t)||n.blocked.toLowerCase().includes(t)||n.waitsOn.toLowerCase().includes(t)||(((r=n.owner)==null?void 0:r.toLowerCase().includes(t))??!1)||n.description.toLowerCase().includes(t)||n.category.toLowerCase().includes(t)}function Bn({dumps:n,filter:t}){const r=qe(n),s=Ue(n),c=t.toLowerCase(),i=c?r.filter(a=>In(a,c)):r,o=c?s.filter(a=>On(a,c)):s,d=pn(o);if(i.length===0&&o.length===0)return e("div",{class:"fade-in",children:e("div",{class:"empty-state",children:[e("div",{class:"icon",style:"color: var(--green)",children:"✔︎"}),e("p",{children:"No problems detected"}),e("p",{class:"sub",children:"All systems nominal"})]})});const l=i.filter(a=>a.severity==="danger").length+o.filter(a=>a.severity==="danger").length,_=i.filter(a=>a.severity==="warn").length+o.filter(a=>a.severity==="warn").length,p=new Map;for(const a of i){let h=p.get(a.category);h||(h=[],p.set(a.category,h)),h.push(a)}return e("div",{class:"fade-in",children:[e("div",{class:"problems-summary",children:[l>0&&e("span",{class:"problems-count problems-count-danger",children:[l," danger"]}),_>0&&e("span",{class:"problems-count problems-count-warn",children:[_," warning",_!==1?"s":""]})]}),d.length>0&&e("div",{class:"card",children:[e("div",{class:"card-head",children:"Likely Root Causes"}),e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Severity"}),e("th",{children:"Owner"}),e("th",{children:"Blocked Groups"}),e("th",{children:"Total Edges"}),e("th",{children:"Worst Wait"})]})}),e("tbody",{children:d.map((a,h)=>e("tr",{class:L(a.severity==="danger"&&"severity-danger",a.severity==="warn"&&"severity-warn"),children:[e("td",{children:e("span",{class:L("state-badge",a.severity==="danger"?"state-dropped":"state-pending"),children:a.severity})}),e("td",{class:"mono",children:a.owner}),e("td",{class:"num",children:a.blockedCount}),e("td",{class:"num",children:a.edgeCount}),e("td",{class:"num",children:a.worstTimingLabel})]},`${a.owner}-${h}`))})]})]}),o.length>0&&e("div",{class:"card",children:[e("div",{class:"card-head",children:"Blocking Relationships"}),e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Severity"}),e("th",{children:"Category"}),e("th",{children:"Process"}),e("th",{children:"Blocked"}),e("th",{children:"Waits On"}),e("th",{children:"Owner"}),e("th",{children:"Impact"}),e("th",{children:"Backtrace"})]})}),e("tbody",{children:o.map((a,h)=>e("tr",{class:L(a.severity==="danger"&&"severity-danger",a.severity==="warn"&&"severity-warn"),children:[e("td",{children:e("span",{class:L("state-badge",a.severity==="danger"?"state-dropped":"state-pending"),children:a.severity})}),e("td",{class:"mono",children:a.category}),e("td",{class:"mono",children:a.process}),e("td",{class:"mono",children:a.blocked}),e("td",{class:"mono",children:a.waitsOn}),e("td",{class:"mono",children:a.owner??"—"}),e("td",{children:[a.description,a.count>1?e("span",{class:"muted",children:[" (",a.count,"x)"]}):null]}),e("td",{children:e(A,{content:a.backtrace})})]},`${a.process}-${a.blocked}-${h}`))})]})]}),Mn.filter(a=>p.has(a)).map(a=>{const h=p.get(a);return e("div",{class:"card",children:[e("div",{class:"card-head",children:["Raw Signals: ",a]}),e("table",{children:[e("thead",{children:e("tr",{children:[e("th",{children:"Severity"}),e("th",{children:"Process"}),e("th",{children:"Resource"}),e("th",{children:"Description"}),e("th",{children:"Timing"}),e("th",{children:"Backtrace"})]})}),e("tbody",{children:h.map((u,k)=>e("tr",{class:L(u.severity==="danger"&&"severity-danger",u.severity==="warn"&&"severity-warn"),children:[e("td",{children:e("span",{class:L("state-badge",u.severity==="danger"?"state-dropped":"state-pending"),children:u.severity})}),e("td",{class:"mono",children:u.process}),e("td",{class:"mono",children:u.resource}),e("td",{children:u.description}),e("td",{class:"num",children:u.timingLabel}),e("td",{children:e(A,{content:u.backtrace})})]},k))})]})]},a)})]})}const Dn=["problems","tasks","threads","locks","sync","requests","connections","processes","shm"],Wn=2e3,qn=3;function Un(){const[n,t]=I([]),[r,s]=I("problems"),[c,i]=I(""),[o,d]=I(null),l=tn(null);nn(()=>{let f=!1,b=null,g=0,m=null;function T(){if(m)return;const x=async()=>{try{const P=await we();f||(t(P),d(null))}catch(P){f||d(String(P))}};x(),m=setInterval(x,2e3)}function S(){m&&(clearInterval(m),m=null)}function F(){if(f)return;const x=on({onDumps:P=>{f||(g=0,t(P),d(null),S())},onError:P=>{f||d(P)},onClose:()=>{f||(g++,g>=qn&&T(),b=setTimeout(F,Wn))}});l.current=x}return F(),()=>{f=!0,b&&clearTimeout(b),S(),l.current&&(l.current(),l.current=null)}},[]);const _=async()=>{try{const f=await we();t(f),d(null)}catch(f){d(String(f))}},p=n.some(f=>f.sync!=null),a=n.some(f=>f.roam!=null),h=n.some(f=>f.shm!=null),u=n.some(f=>f.locks!=null),k=Dn.filter(f=>f==="problems"?!0:!(f==="sync"&&!p||f==="requests"&&!a||f==="connections"&&!a||f==="shm"&&!h||f==="locks"&&!u));return e("div",{class:"app",children:[e(an,{dumps:n,filter:c,onFilter:i,onRefresh:_,error:o}),e(kn,{tabs:k,active:r,onSelect:s,dumps:n}),e("div",{class:"content",children:[r==="problems"&&e(Bn,{dumps:n,filter:c}),r==="tasks"&&e(Cn,{dumps:n,filter:c}),r==="threads"&&e(Sn,{dumps:n,filter:c}),r==="locks"&&e(xn,{dumps:n,filter:c}),r==="sync"&&e(Pn,{dumps:n,filter:c}),r==="requests"&&e(Hn,{dumps:n,filter:c}),r==="connections"&&e(En,{dumps:n,filter:c}),r==="processes"&&e(Nn,{dumps:n,filter:c}),r==="shm"&&e(An,{dumps:n,filter:c})]})]})}Qe(e(Un,{}),document.getElementById("app"));
