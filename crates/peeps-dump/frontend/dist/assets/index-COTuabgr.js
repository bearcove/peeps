(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerPolicy&&(i.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?i.credentials="include":c.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(c){if(c.ep)return;c.ep=!0;const i=r(c);fetch(c.href,i)}})();var Y,v,$e,R,de,xe,Se,Te,ce,ne,te,O={},Pe=[],We=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,J=Array.isArray;function E(e,t){for(var r in t)e[r]=t[r];return e}function ie(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Ue(e,t,r){var s,c,i,a={};for(i in t)i=="key"?s=t[i]:i=="ref"?c=t[i]:a[i]=t[i];if(arguments.length>2&&(a.children=arguments.length>3?Y.call(arguments,2):r),typeof e=="function"&&e.defaultProps!=null)for(i in e.defaultProps)a[i]===void 0&&(a[i]=e.defaultProps[i]);return V(e,a,s,c,null)}function V(e,t,r,s,c){var i={type:e,props:t,key:r,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:c??++$e,__i:-1,__u:0};return c==null&&v.vnode!=null&&v.vnode(i),i}function B(e){return e.children}function X(e,t){this.props=e,this.context=t}function M(e,t){if(t==null)return e.__?M(e.__,e.__i+1):null;for(var r;t<e.__k.length;t++)if((r=e.__k[t])!=null&&r.__e!=null)return r.__e;return typeof e.type=="function"?M(e):null}function Ne(e){var t,r;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((r=e.__k[t])!=null&&r.__e!=null){e.__e=e.__c.base=r.__e;break}return Ne(e)}}function _e(e){(!e.__d&&(e.__d=!0)&&R.push(e)&&!K.__r++||de!=v.debounceRendering)&&((de=v.debounceRendering)||xe)(K)}function K(){for(var e,t,r,s,c,i,a,l=1;R.length;)R.length>l&&R.sort(Se),e=R.shift(),l=R.length,e.__d&&(r=void 0,s=void 0,c=(s=(t=e).__v).__e,i=[],a=[],t.__P&&((r=E({},s)).__v=s.__v+1,v.vnode&&v.vnode(r),oe(t.__P,r,s,t.__n,t.__P.namespaceURI,32&s.__u?[c]:null,i,c??M(s),!!(32&s.__u),a),r.__v=s.__v,r.__.__k[r.__i]=r,Fe(i,r,a),s.__e=s.__=null,r.__e!=c&&Ne(r)));K.__r=0}function He(e,t,r,s,c,i,a,l,o,_,h){var d,p,u,w,f,k,g,m=s&&s.__k||Pe,x=t.length;for(o=ze(r,t,m,o,x),d=0;d<x;d++)(u=r.__k[d])!=null&&(p=u.__i==-1?O:m[u.__i]||O,u.__i=d,k=oe(e,u,p,c,i,a,l,o,_,h),w=u.__e,u.ref&&p.ref!=u.ref&&(p.ref&&ae(p.ref,null,u),h.push(u.ref,u.__c||w,u)),f==null&&w!=null&&(f=w),(g=!!(4&u.__u))||p.__k===u.__k?o=Ee(u,o,e,g):typeof u.type=="function"&&k!==void 0?o=k:w&&(o=w.nextSibling),u.__u&=-7);return r.__e=f,o}function ze(e,t,r,s,c){var i,a,l,o,_,h=r.length,d=h,p=0;for(e.__k=new Array(c),i=0;i<c;i++)(a=t[i])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=e.__k[i]=V(null,a,null,null,null):J(a)?a=e.__k[i]=V(B,{children:a},null,null,null):a.constructor===void 0&&a.__b>0?a=e.__k[i]=V(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):e.__k[i]=a,o=i+p,a.__=e,a.__b=e.__b+1,l=null,(_=a.__i=Ve(a,r,o,d))!=-1&&(d--,(l=r[_])&&(l.__u|=2)),l==null||l.__v==null?(_==-1&&(c>h?p--:c<h&&p++),typeof a.type!="function"&&(a.__u|=4)):_!=o&&(_==o-1?p--:_==o+1?p++:(_>o?p--:p++,a.__u|=4))):e.__k[i]=null;if(d)for(i=0;i<h;i++)(l=r[i])!=null&&(2&l.__u)==0&&(l.__e==s&&(s=M(l)),Ae(l,l));return s}function Ee(e,t,r,s){var c,i;if(typeof e.type=="function"){for(c=e.__k,i=0;c&&i<c.length;i++)c[i]&&(c[i].__=e,t=Ee(c[i],t,r,s));return t}e.__e!=t&&(s&&(t&&e.type&&!t.parentNode&&(t=M(e)),r.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Ve(e,t,r,s){var c,i,a,l=e.key,o=e.type,_=t[r],h=_!=null&&(2&_.__u)==0;if(_===null&&l==null||h&&l==_.key&&o==_.type)return r;if(s>(h?1:0)){for(c=r-1,i=r+1;c>=0||i<t.length;)if((_=t[a=c>=0?c--:i++])!=null&&(2&_.__u)==0&&l==_.key&&o==_.type)return a}return-1}function he(e,t,r){t[0]=="-"?e.setProperty(t,r??""):e[t]=r==null?"":typeof r!="number"||We.test(t)?r:r+"px"}function z(e,t,r,s,c){var i,a;e:if(t=="style")if(typeof r=="string")e.style.cssText=r;else{if(typeof s=="string"&&(e.style.cssText=s=""),s)for(t in s)r&&t in r||he(e.style,t,"");if(r)for(t in r)s&&r[t]==s[t]||he(e.style,t,r[t])}else if(t[0]=="o"&&t[1]=="n")i=t!=(t=t.replace(Te,"$1")),a=t.toLowerCase(),t=a in e||t=="onFocusOut"||t=="onFocusIn"?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=r,r?s?r.u=s.u:(r.u=ce,e.addEventListener(t,i?te:ne,i)):e.removeEventListener(t,i?te:ne,i);else{if(c=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&r==1?"":r))}}function ue(e){return function(t){if(this.l){var r=this.l[t.type+e];if(t.t==null)t.t=ce++;else if(t.t<r.u)return;return r(v.event?v.event(t):t)}}}function oe(e,t,r,s,c,i,a,l,o,_){var h,d,p,u,w,f,k,g,m,x,S,F,T,P,U,I,Q,N=t.type;if(t.constructor!==void 0)return null;128&r.__u&&(o=!!(32&r.__u),i=[l=t.__e=r.__e]),(h=v.__b)&&h(t);e:if(typeof N=="function")try{if(g=t.props,m="prototype"in N&&N.prototype.render,x=(h=N.contextType)&&s[h.__c],S=h?x?x.props.value:h.__:s,r.__c?k=(d=t.__c=r.__c).__=d.__E:(m?t.__c=d=new N(g,S):(t.__c=d=new X(g,S),d.constructor=N,d.render=je),x&&x.sub(d),d.state||(d.state={}),d.__n=s,p=d.__d=!0,d.__h=[],d._sb=[]),m&&d.__s==null&&(d.__s=d.state),m&&N.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=E({},d.__s)),E(d.__s,N.getDerivedStateFromProps(g,d.__s))),u=d.props,w=d.state,d.__v=t,p)m&&N.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),m&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(m&&N.getDerivedStateFromProps==null&&g!==u&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(g,S),t.__v==r.__v||!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(g,d.__s,S)===!1){for(t.__v!=r.__v&&(d.props=g,d.state=d.__s,d.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.some(function(A){A&&(A.__=t)}),F=0;F<d._sb.length;F++)d.__h.push(d._sb[F]);d._sb=[],d.__h.length&&a.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(g,d.__s,S),m&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(u,w,f)})}if(d.context=S,d.props=g,d.__P=e,d.__e=!1,T=v.__r,P=0,m){for(d.state=d.__s,d.__d=!1,T&&T(t),h=d.render(d.props,d.state,d.context),U=0;U<d._sb.length;U++)d.__h.push(d._sb[U]);d._sb=[]}else do d.__d=!1,T&&T(t),h=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++P<25);d.state=d.__s,d.getChildContext!=null&&(s=E(E({},s),d.getChildContext())),m&&!p&&d.getSnapshotBeforeUpdate!=null&&(f=d.getSnapshotBeforeUpdate(u,w)),I=h,h!=null&&h.type===B&&h.key==null&&(I=Re(h.props.children)),l=He(e,J(I)?I:[I],t,r,s,c,i,a,l,o,_),d.base=t.__e,t.__u&=-161,d.__h.length&&a.push(d),k&&(d.__E=d.__=null)}catch(A){if(t.__v=null,o||i!=null)if(A.then){for(t.__u|=o?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;i[i.indexOf(l)]=null,t.__e=l}else{for(Q=i.length;Q--;)ie(i[Q]);se(t)}else t.__e=r.__e,t.__k=r.__k,A.then||se(t);v.__e(A,t,r)}else i==null&&t.__v==r.__v?(t.__k=r.__k,t.__e=r.__e):l=t.__e=Xe(r.__e,t,r,s,c,i,a,o,_);return(h=v.diffed)&&h(t),128&t.__u?void 0:l}function se(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(se)}function Fe(e,t,r){for(var s=0;s<r.length;s++)ae(r[s],r[++s],r[++s]);v.__c&&v.__c(t,e),e.some(function(c){try{e=c.__h,c.__h=[],e.some(function(i){i.call(c)})}catch(i){v.__e(i,c.__v)}})}function Re(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:J(e)?e.map(Re):E({},e)}function Xe(e,t,r,s,c,i,a,l,o){var _,h,d,p,u,w,f,k=r.props||O,g=t.props,m=t.type;if(m=="svg"?c="http://www.w3.org/2000/svg":m=="math"?c="http://www.w3.org/1998/Math/MathML":c||(c="http://www.w3.org/1999/xhtml"),i!=null){for(_=0;_<i.length;_++)if((u=i[_])&&"setAttribute"in u==!!m&&(m?u.localName==m:u.nodeType==3)){e=u,i[_]=null;break}}if(e==null){if(m==null)return document.createTextNode(g);e=document.createElementNS(c,m,g.is&&g),l&&(v.__m&&v.__m(t,i),l=!1),i=null}if(m==null)k===g||l&&e.data==g||(e.data=g);else{if(i=i&&Y.call(e.childNodes),!l&&i!=null)for(k={},_=0;_<e.attributes.length;_++)k[(u=e.attributes[_]).name]=u.value;for(_ in k)if(u=k[_],_!="children"){if(_=="dangerouslySetInnerHTML")d=u;else if(!(_ in g)){if(_=="value"&&"defaultValue"in g||_=="checked"&&"defaultChecked"in g)continue;z(e,_,null,u,c)}}for(_ in g)u=g[_],_=="children"?p=u:_=="dangerouslySetInnerHTML"?h=u:_=="value"?w=u:_=="checked"?f=u:l&&typeof u!="function"||k[_]===u||z(e,_,u,k[_],c);if(h)l||d&&(h.__html==d.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(d&&(e.innerHTML=""),He(t.type=="template"?e.content:e,J(p)?p:[p],t,r,s,m=="foreignObject"?"http://www.w3.org/1999/xhtml":c,i,a,i?i[0]:r.__k&&M(r,0),l,o),i!=null)for(_=i.length;_--;)ie(i[_]);l||(_="value",m=="progress"&&w==null?e.removeAttribute("value"):w!=null&&(w!==e[_]||m=="progress"&&!w||m=="option"&&w!=k[_])&&z(e,_,w,k[_],c),_="checked",f!=null&&f!=e[_]&&z(e,_,f,k[_],c))}return e}function ae(e,t,r){try{if(typeof e=="function"){var s=typeof e.__u=="function";s&&e.__u(),s&&t==null||(e.__u=e(t))}else e.current=t}catch(c){v.__e(c,r)}}function Ae(e,t,r){var s,c;if(v.unmount&&v.unmount(e),(s=e.ref)&&(s.current&&s.current!=e.__e||ae(s,null,t)),(s=e.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(i){v.__e(i,t)}s.base=s.__P=null}if(s=e.__k)for(c=0;c<s.length;c++)s[c]&&Ae(s[c],t,r||typeof e.type!="function");r||ie(e.__e),e.__c=e.__=e.__e=void 0}function je(e,t,r){return this.constructor(e,r)}function Ke(e,t,r){var s,c,i,a;t==document&&(t=document.documentElement),v.__&&v.__(e,t),c=(s=!1)?null:t.__k,i=[],a=[],oe(t,e=t.__k=Ue(B,null,[e]),c||O,O,t.namespaceURI,c?null:t.firstChild?Y.call(t.childNodes):null,i,c?c.__e:t.firstChild,s,a),Fe(i,e,a)}Y=Pe.slice,v={__e:function(e,t,r,s){for(var c,i,a;t=t.__;)if((c=t.__c)&&!c.__)try{if((i=c.constructor)&&i.getDerivedStateFromError!=null&&(c.setState(i.getDerivedStateFromError(e)),a=c.__d),c.componentDidCatch!=null&&(c.componentDidCatch(e,s||{}),a=c.__d),a)return c.__E=c}catch(l){e=l}throw e}},$e=0,X.prototype.setState=function(e,t){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=E({},this.state),typeof e=="function"&&(e=e(E({},r),this.props)),e&&E(r,e),e!=null&&this.__v&&(t&&this._sb.push(t),_e(this))},X.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),_e(this))},X.prototype.render=B,R=[],xe=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Se=function(e,t){return e.__v.__b-t.__v.__b},K.__r=0,Te=/(PointerCapture)$|Capture$/i,ce=0,ne=ue(!1),te=ue(!0);var Ge=0;function n(e,t,r,s,c,i){t||(t={});var a,l,o=t;if("ref"in o)for(l in o={},t)l=="ref"?a=t[l]:o[l]=t[l];var _={type:e,props:o,key:r,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Ge,__i:-1,__u:0,__source:c,__self:i};if(typeof e=="function"&&(a=e.defaultProps))for(l in a)o[l]===void 0&&(o[l]=a[l]);return v.vnode&&v.vnode(_),_}var W,b,Z,pe,G=0,De=[],C=v,fe=C.__b,me=C.__r,ge=C.diffed,ve=C.__c,ye=C.unmount,ke=C.__;function le(e,t){C.__h&&C.__h(b,e,G||t),G=0;var r=b.__H||(b.__H={__:[],__h:[]});return e>=r.__.length&&r.__.push({}),r.__[e]}function D(e){return G=1,Ye(qe,e)}function Ye(e,t,r){var s=le(W++,2);if(s.t=e,!s.__c&&(s.__=[qe(void 0,t),function(l){var o=s.__N?s.__N[0]:s.__[0],_=s.t(o,l);o!==_&&(s.__N=[_,s.__[1]],s.__c.setState({}))}],s.__c=b,!b.__f)){var c=function(l,o,_){if(!s.__c.__H)return!0;var h=s.__c.__H.__.filter(function(p){return!!p.__c});if(h.every(function(p){return!p.__N}))return!i||i.call(this,l,o,_);var d=s.__c.props!==l;return h.forEach(function(p){if(p.__N){var u=p.__[0];p.__=p.__N,p.__N=void 0,u!==p.__[0]&&(d=!0)}}),i&&i.call(this,l,o,_)||d};b.__f=!0;var i=b.shouldComponentUpdate,a=b.componentWillUpdate;b.componentWillUpdate=function(l,o,_){if(this.__e){var h=i;i=void 0,c(l,o,_),i=h}a&&a.call(this,l,o,_)},b.shouldComponentUpdate=c}return s.__N||s.__}function Je(e,t){var r=le(W++,3);!C.__s&&Me(r.__H,t)&&(r.__=e,r.u=t,b.__H.__h.push(r))}function Qe(e){return G=5,Ze(function(){return{current:e}},[])}function Ze(e,t){var r=le(W++,7);return Me(r.__H,t)&&(r.__=e(),r.__H=t,r.__h=e),r.__}function en(){for(var e;e=De.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(j),e.__H.__h.forEach(re),e.__H.__h=[]}catch(t){e.__H.__h=[],C.__e(t,e.__v)}}C.__b=function(e){b=null,fe&&fe(e)},C.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),ke&&ke(e,t)},C.__r=function(e){me&&me(e),W=0;var t=(b=e.__c).__H;t&&(Z===b?(t.__h=[],b.__h=[],t.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(t.__h.forEach(j),t.__h.forEach(re),t.__h=[],W=0)),Z=b},C.diffed=function(e){ge&&ge(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(De.push(t)!==1&&pe===C.requestAnimationFrame||((pe=C.requestAnimationFrame)||nn)(en)),t.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),Z=b=null},C.__c=function(e,t){t.some(function(r){try{r.__h.forEach(j),r.__h=r.__h.filter(function(s){return!s.__||re(s)})}catch(s){t.some(function(c){c.__h&&(c.__h=[])}),t=[],C.__e(s,r.__v)}}),ve&&ve(e,t)},C.unmount=function(e){ye&&ye(e);var t,r=e.__c;r&&r.__H&&(r.__H.__.forEach(function(s){try{j(s)}catch(c){t=c}}),r.__H=void 0,t&&C.__e(t,r.__v))};var be=typeof requestAnimationFrame=="function";function nn(e){var t,r=function(){clearTimeout(s),be&&cancelAnimationFrame(t),setTimeout(e)},s=setTimeout(r,35);be&&(t=requestAnimationFrame(r))}function j(e){var t=b,r=e.__c;typeof r=="function"&&(e.__c=void 0,r()),b=t}function re(e){var t=b;e.__c=e.__(),b=t}function Me(e,t){return!e||e.length!==t.length||t.some(function(r,s){return r!==e[s]})}function qe(e,t){return typeof t=="function"?t(e):t}async function we(){const e=await fetch("/api/dumps");if(!e.ok)throw new Error(`fetch failed: ${e.status}`);return e.json()}function tn(e){const r=`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}/api/ws`,s=new WebSocket(r);return s.onmessage=c=>{try{const i=JSON.parse(c.data);e.onDumps(i)}catch(i){e.onError(`WebSocket parse error: ${i}`)}},s.onerror=()=>{e.onError("WebSocket error")},s.onclose=()=>{e.onClose()},()=>{s.close()}}function sn({dumps:e,filter:t,onFilter:r,onRefresh:s,error:c}){const i=e.reduce((l,o)=>l+o.tasks.length,0),a=e.reduce((l,o)=>l+o.threads.length,0);return n("div",{class:"header",children:[n("div",{class:"header-brand",children:[n("span",{class:"accent",children:"peeps"})," dashboard"]}),n("div",{class:"header-sep"}),n("div",{class:"header-stats",children:[n("span",{children:[n("span",{class:"val",children:e.length})," processes"]}),n("span",{children:[n("span",{class:"val",children:i})," tasks"]}),n("span",{children:[n("span",{class:"val",children:a})," threads"]})]}),n("div",{class:"header-spacer"}),c&&n("span",{class:"header-error",children:c}),n("input",{class:"search-box",type:"text",placeholder:"Filter...",autocomplete:"off",spellcheck:!1,value:t,onInput:l=>r(l.target.value)}),n("button",{class:"expand-trigger",style:"padding: 5px 12px; font-size: 12px",onClick:s,children:"Refresh"})]})}function H(e){return e==null?"—":e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":e<1073741824?(e/1048576).toFixed(1)+" MB":(e/1073741824).toFixed(2)+" GB"}function y(e){return e>=60?(e/60).toFixed(1)+"m":e>=1?e.toFixed(2)+"s":(e*1e3).toFixed(0)+"ms"}function L(e){return e>=3600?(e/3600).toFixed(1)+"h":e>=60?(e/60).toFixed(1)+"m":e.toFixed(1)+"s"}const rn=["std::backtrace","std::sys","backtrace_rs","backtrace::","vx_dump::thread_stacks::sigprof_handler","__os_lock","_pthread_","pthread_","tokio::runtime::park","tokio::runtime::context","tokio::runtime::scheduler","tokio::runtime::runtime","tokio::runtime::blocking","core::ops::function","std::panicking","std::panic","std::rt::lang_start","<unknown>","tokio::park","mio::poll"];function cn(e){if(!e)return null;for(const t of e.split(`
`)){const r=t.trim().match(/^\d+:\s+(.+)/);if(!r)continue;const s=r[1].split(`
`)[0].trim();if(!rn.some(c=>s.startsWith(c)))return s}return null}function $(...e){return e.filter(Boolean).join(" ")}function on(e){return e.some(t=>t.severity==="danger")}function Be(e){const t=[];for(const r of e){const s=r.process_name;an(s,r,t),ln(s,r,t),dn(s,r,t),_n(s,r,t),hn(s,r,t),un(s,r,t)}return t.sort((r,s)=>r.severity!==s.severity?r.severity==="danger"?-1:1:s.timing-r.timing),t}function an(e,t,r){for(const s of t.tasks)if(s.state==="Polling"&&s.poll_events.length>0){const c=s.poll_events[s.poll_events.length-1];c.duration_secs!=null&&c.duration_secs>1?r.push({severity:"danger",category:"Tasks",process:e,resource:s.name,description:`Polling for ${y(c.duration_secs)}`,timing:c.duration_secs,timingLabel:y(c.duration_secs),backtrace:c.backtrace??s.spawn_backtrace}):c.duration_secs!=null&&c.duration_secs>.1&&r.push({severity:"warn",category:"Tasks",process:e,resource:s.name,description:`Polling for ${y(c.duration_secs)}`,timing:c.duration_secs,timingLabel:y(c.duration_secs),backtrace:c.backtrace??s.spawn_backtrace})}else s.state==="Pending"&&s.age_secs>30&&s.poll_events.length===0&&r.push({severity:"warn",category:"Tasks",process:e,resource:s.name,description:`Pending for ${L(s.age_secs)}, never polled`,timing:s.age_secs,timingLabel:L(s.age_secs),backtrace:s.spawn_backtrace})}function ln(e,t,r){for(const s of t.threads)s.same_location_count>=10?r.push({severity:"danger",category:"Threads",process:e,resource:s.name,description:`Stuck at same location for ${s.same_location_count} samples`,timing:s.same_location_count,timingLabel:`${s.same_location_count} samples stuck`,backtrace:s.backtrace}):s.same_location_count>=5&&r.push({severity:"warn",category:"Threads",process:e,resource:s.name,description:`Same location for ${s.same_location_count} samples`,timing:s.same_location_count,timingLabel:`${s.same_location_count} samples stuck`,backtrace:s.backtrace})}function dn(e,t,r){if(t.locks)for(const s of t.locks.locks){for(const c of s.holders)c.held_secs>5?r.push({severity:"danger",category:"Locks",process:e,resource:s.name,description:`Held for ${y(c.held_secs)} (${c.kind})`,timing:c.held_secs,timingLabel:y(c.held_secs),backtrace:c.backtrace}):c.held_secs>1&&r.push({severity:"warn",category:"Locks",process:e,resource:s.name,description:`Held for ${y(c.held_secs)} (${c.kind})`,timing:c.held_secs,timingLabel:y(c.held_secs),backtrace:c.backtrace});for(const c of s.waiters)c.waiting_secs>5?r.push({severity:"danger",category:"Locks",process:e,resource:s.name,description:`Waiting for ${y(c.waiting_secs)} (${c.kind})`,timing:c.waiting_secs,timingLabel:y(c.waiting_secs),backtrace:c.backtrace}):c.waiting_secs>1&&r.push({severity:"warn",category:"Locks",process:e,resource:s.name,description:`Waiting for ${y(c.waiting_secs)} (${c.kind})`,timing:c.waiting_secs,timingLabel:y(c.waiting_secs),backtrace:c.backtrace})}}function _n(e,t,r){if(t.sync){for(const s of t.sync.mpsc_channels)if(s.send_waiters>0&&s.receiver_closed)r.push({severity:"danger",category:"Channels",process:e,resource:s.name,description:`${s.send_waiters} blocked sender(s), receiver closed`,timing:s.age_secs,timingLabel:L(s.age_secs),backtrace:null});else if(s.sender_closed||s.receiver_closed){const c=s.sender_closed?"sender":"receiver";r.push({severity:"danger",category:"Channels",process:e,resource:s.name,description:`Broken pipe: ${c} closed`,timing:s.age_secs,timingLabel:L(s.age_secs),backtrace:null})}else s.send_waiters>0&&r.push({severity:"warn",category:"Channels",process:e,resource:s.name,description:`${s.send_waiters} sender(s) blocked (backpressure)`,timing:s.age_secs,timingLabel:L(s.age_secs),backtrace:null});for(const s of t.sync.oneshot_channels)s.state==="SenderDropped"||s.state==="ReceiverDropped"?r.push({severity:"danger",category:"Channels",process:e,resource:s.name,description:`Oneshot: ${s.state}`,timing:s.age_secs,timingLabel:L(s.age_secs),backtrace:null}):s.state==="Pending"&&s.age_secs>10&&r.push({severity:"warn",category:"Channels",process:e,resource:s.name,description:`Oneshot pending for ${L(s.age_secs)}`,timing:s.age_secs,timingLabel:L(s.age_secs),backtrace:null});for(const s of t.sync.once_cells)s.state==="Initializing"&&s.age_secs>5&&r.push({severity:"warn",category:"Channels",process:e,resource:s.name,description:`OnceCell initializing for ${L(s.age_secs)}`,timing:s.age_secs,timingLabel:L(s.age_secs),backtrace:null})}}function hn(e,t,r){if(t.roam)for(const s of t.roam.connections)for(const c of s.in_flight){const i=c.method_name??`method#${c.method_id}`;c.elapsed_secs>10?r.push({severity:"danger",category:"RPC",process:e,resource:`${s.name}: ${i}`,description:`In-flight for ${y(c.elapsed_secs)}`,timing:c.elapsed_secs,timingLabel:y(c.elapsed_secs),backtrace:c.backtrace}):c.elapsed_secs>2&&r.push({severity:"warn",category:"RPC",process:e,resource:`${s.name}: ${i}`,description:`In-flight for ${y(c.elapsed_secs)}`,timing:c.elapsed_secs,timingLabel:y(c.elapsed_secs),backtrace:c.backtrace})}}function un(e,t,r){if(t.shm){for(const s of t.shm.segments)for(const c of s.peers){if(c.state!=="Attached")continue;const i=c.name??`peer#${c.peer_id}`;c.time_since_heartbeat_ms!=null&&c.time_since_heartbeat_ms>5e3?r.push({severity:"danger",category:"SHM",process:e,resource:i,description:`No heartbeat for ${(c.time_since_heartbeat_ms/1e3).toFixed(1)}s`,timing:c.time_since_heartbeat_ms/1e3,timingLabel:y(c.time_since_heartbeat_ms/1e3),backtrace:null}):c.time_since_heartbeat_ms!=null&&c.time_since_heartbeat_ms>2e3&&r.push({severity:"warn",category:"SHM",process:e,resource:i,description:`No heartbeat for ${(c.time_since_heartbeat_ms/1e3).toFixed(1)}s`,timing:c.time_since_heartbeat_ms/1e3,timingLabel:y(c.time_since_heartbeat_ms/1e3),backtrace:null})}for(const s of t.shm.channels)s.len===s.capacity&&s.capacity>0&&r.push({severity:"warn",category:"SHM",process:e,resource:s.name,description:`Queue full (${s.len}/${s.capacity})`,timing:s.capacity,timingLabel:`${s.len}/${s.capacity}`,backtrace:null})}}function pn(e,t){switch(e){case"problems":return null;case"tasks":return t.reduce((r,s)=>r+s.tasks.length,0);case"threads":return t.reduce((r,s)=>r+s.threads.length,0);case"locks":return t.reduce((r,s)=>{var c;return r+(((c=s.locks)==null?void 0:c.locks.length)??0)},0);case"sync":{let r=0;for(const s of t)s.sync&&(r+=s.sync.mpsc_channels.length+s.sync.oneshot_channels.length+s.sync.watch_channels.length+s.sync.once_cells.length);return r}case"requests":return t.reduce((r,s)=>{var c;return r+(((c=s.roam)==null?void 0:c.connections.reduce((i,a)=>i+a.in_flight.length,0))??0)},0);case"connections":return t.reduce((r,s)=>{var c;return r+(((c=s.roam)==null?void 0:c.connections.length)??0)},0);case"processes":return t.length;case"shm":return null}}const Ce={problems:"Problems",tasks:"Tasks",threads:"Threads",locks:"Locks",sync:"Sync",requests:"Requests",connections:"Connections",processes:"Processes",shm:"SHM"};function fn({tabs:e,active:t,onSelect:r,dumps:s}){const c=Be(s),i=c.length,a=on(c);return n("div",{class:"tab-bar",children:e.map(l=>{if(l==="problems")return n("div",{class:$("tab",l===t&&"active"),onClick:()=>r(l),children:[Ce[l],i>0&&n("span",{class:$("tab-badge",a?"tab-badge-danger":"tab-badge-warn"),children:i})]},l);const o=pn(l,s);return n("div",{class:$("tab",l===t&&"active"),onClick:()=>r(l),children:[Ce[l],o!=null&&n("span",{class:"tab-badge",children:o})]},l)})})}function q({label:e="trace",content:t}){const[r,s]=D(!1);return t?n(B,{children:[n("span",{class:"expand-trigger",onClick:()=>s(!r),children:e}),r&&n("div",{class:"expandable-content open",children:t})]}):n("span",{class:"muted",children:"—"})}function Ie(e){switch(e){case"Polling":return"state-polling";case"Completed":return"state-completed";default:return"state-pending"}}function mn(e){if(e.state==="Polling"){const t=e.poll_events[e.poll_events.length-1];if((t==null?void 0:t.duration_secs)!=null&&t.duration_secs>1)return"severity-danger";if((t==null?void 0:t.duration_secs)!=null&&t.duration_secs>.1)return"severity-warn"}return""}function gn(e,t){var s;if(!t)return!0;const r=t.toLowerCase();return e.name.toLowerCase().includes(r)||e.process.toLowerCase().includes(r)||e.state.toLowerCase().includes(r)||(((s=e.parent_task_name)==null?void 0:s.toLowerCase().includes(r))??!1)||String(e.id).includes(r)}function vn({dumps:e,filter:t}){const[r,s]=D("table"),c=[];for(const a of e)for(const l of a.tasks)c.push({...l,process:a.process_name,pid:a.pid});const i=c.filter(a=>gn(a,t));return c.length===0?n("div",{class:"empty-state fade-in",children:[n("div",{class:"icon",children:"T"}),n("p",{children:"No tasks tracked"}),n("p",{class:"sub",children:"Tasks appear when using peeps::tasks::spawn_tracked()"})]}):n("div",{class:"fade-in",children:[n("div",{style:"margin-bottom: 12px; display: flex; gap: 8px",children:[n("button",{class:$("expand-trigger",r==="table"&&"active"),style:"padding: 4px 10px",onClick:()=>s("table"),children:"Table"}),n("button",{class:$("expand-trigger",r==="tree"&&"active"),style:"padding: 4px 10px",onClick:()=>s("tree"),children:"Tree"})]}),r==="table"?n(yn,{tasks:i}):n(kn,{tasks:i})]})}function yn({tasks:e}){return n("div",{class:"card",children:n("table",{children:[n("thead",{children:n("tr",{children:[n("th",{children:"ID"}),n("th",{children:"Process"}),n("th",{children:"Name"}),n("th",{children:"State"}),n("th",{children:"Age"}),n("th",{children:"Parent"}),n("th",{children:"Polls"}),n("th",{children:"Last Poll"}),n("th",{children:"Backtrace"})]})}),n("tbody",{children:e.map(t=>n("tr",{class:mn(t),children:[n("td",{class:"mono",children:["#",t.id]}),n("td",{class:"mono",children:t.process}),n("td",{class:"mono",children:t.name}),n("td",{children:n("span",{class:$("state-badge",Ie(t.state)),children:t.state})}),n("td",{class:"num",children:L(t.age_secs)}),n("td",{class:"mono",children:t.parent_task_id!=null?n("span",{children:[t.parent_task_name??""," (#",t.parent_task_id,")"]}):n("span",{class:"muted",children:"—"})}),n("td",{class:"num",children:t.poll_events.length}),n("td",{class:"num",children:t.poll_events.length>0?y(t.poll_events[t.poll_events.length-1].duration_secs??0):"—"}),n("td",{children:n(q,{content:t.spawn_backtrace||null})})]},`${t.pid}-${t.id}`))})]})})}function kn({tasks:e}){const t=new Map;for(const c of e)t.set(c.id,c);const r=e.filter(c=>c.parent_task_id==null||!t.has(c.parent_task_id)),s=new Map;for(const c of e)if(c.parent_task_id!=null&&t.has(c.parent_task_id)){const i=s.get(c.parent_task_id)??[];i.push(c),s.set(c.parent_task_id,i)}return n("div",{children:r.map(c=>n(Oe,{task:c,children:s,depth:0},c.id))})}function Oe({task:e,children:t,depth:r}){const s=t.get(e.id)??[];return n("div",{class:r===0?"tree-node-root":"tree-node",children:[n("div",{class:"tree-item",children:[n("span",{class:$("state-badge",Ie(e.state)),style:"margin-right: 6px",children:e.state}),n("span",{class:"mono",children:["#",e.id," ",e.name]}),n("span",{class:"muted",style:"margin-left: 8px",children:[e.process," · ",L(e.age_secs)]})]}),s.map(c=>n(Oe,{task:c,children:t,depth:r+1},c.id))]})}function bn(e){return e.same_location_count>=10?"severity-danger":e.same_location_count>=5?"severity-warn":""}function wn({dumps:e,filter:t}){const r=[];for(const i of e)for(const a of i.threads)r.push({...a,process:i.process_name});const s=t.toLowerCase(),c=r.filter(i=>{var a;return!s||i.name.toLowerCase().includes(s)||i.process.toLowerCase().includes(s)||(((a=i.dominant_frame)==null?void 0:a.toLowerCase().includes(s))??!1)});return r.length===0?n("div",{class:"empty-state fade-in",children:[n("div",{class:"icon",children:"T"}),n("p",{children:"No thread data"})]}):n("div",{class:"card fade-in",children:n("table",{children:[n("thead",{children:n("tr",{children:[n("th",{children:"Process"}),n("th",{children:"Thread"}),n("th",{children:"Samples"}),n("th",{children:"Responded"}),n("th",{children:"Stuck"}),n("th",{children:"Top Frame"}),n("th",{children:"Backtrace"})]})}),n("tbody",{children:c.map((i,a)=>n("tr",{class:bn(i),children:[n("td",{class:"mono",children:i.process}),n("td",{class:"mono",children:i.name}),n("td",{class:"num",children:i.samples}),n("td",{class:"num",children:i.responded}),n("td",{class:$("num",i.same_location_count>=5&&"text-red"),children:i.same_location_count}),n("td",{class:"mono",style:"max-width:400px;overflow:hidden;text-overflow:ellipsis",children:i.dominant_frame??cn(i.backtrace)??n("span",{class:"muted",children:"—"})}),n("td",{children:n(q,{content:i.backtrace})})]},a))})]})})}function Cn({dumps:e,filter:t}){const r=[];for(const i of e)if(i.locks)for(const a of i.locks.locks)r.push({...a,process:i.process_name});const s=t.toLowerCase(),c=r.filter(i=>!s||i.name.toLowerCase().includes(s)||i.process.toLowerCase().includes(s));return r.length===0?n("div",{class:"empty-state fade-in",children:[n("div",{class:"icon",children:"L"}),n("p",{children:"No contended locks"})]}):n("div",{class:"fade-in",children:c.map((i,a)=>n("div",{class:"card",children:[n("div",{class:"card-head",children:[n("span",{class:"mono",children:i.process}),n("span",{class:"muted",children:"/"}),n("span",{class:"mono",children:i.name}),n("span",{class:"muted",style:"margin-left: auto",children:[i.acquires," acquires, ",i.releases," releases"]})]}),i.holders.length>0&&n("table",{children:[n("thead",{children:n("tr",{children:[n("th",{children:"Holder"}),n("th",{children:"Kind"}),n("th",{children:"Held"}),n("th",{children:"Task"}),n("th",{children:"Backtrace"})]})}),n("tbody",{children:i.holders.map((l,o)=>n("tr",{children:[n("td",{class:"mono",children:["holder #",o]}),n("td",{class:"mono",children:l.kind}),n("td",{class:"num",children:y(l.held_secs)}),n("td",{class:"mono",children:l.task_id!=null?n("span",{children:[l.task_name??""," (#",l.task_id,")"]}):n("span",{class:"muted",children:"—"})}),n("td",{children:n(q,{content:l.backtrace})})]},o))})]}),i.waiters.length>0&&n("table",{children:[n("thead",{children:n("tr",{children:[n("th",{children:"Waiter"}),n("th",{children:"Kind"}),n("th",{children:"Waiting"}),n("th",{children:"Task"}),n("th",{children:"Backtrace"})]})}),n("tbody",{children:i.waiters.map((l,o)=>n("tr",{class:l.waiting_secs>1?"severity-warn":"",children:[n("td",{class:"mono",children:["waiter #",o]}),n("td",{class:"mono",children:l.kind}),n("td",{class:"num",children:y(l.waiting_secs)}),n("td",{class:"mono",children:l.task_id!=null?n("span",{children:[l.task_name??""," (#",l.task_id,")"]}):n("span",{class:"muted",children:"—"})}),n("td",{children:n(q,{content:l.backtrace})})]},o))})]})]},a))})}function Le(e){switch(e){case"Pending":return"state-pending";case"Sent":case"Received":case"Initialized":return"state-completed";case"Initializing":return"state-initializing";case"SenderDropped":case"ReceiverDropped":return"state-dropped";case"Empty":return"state-empty";default:return""}}function ee(e,t){return e==null?n("span",{class:"muted",children:"—"}):n("span",{class:"mono",children:[t??""," (#",e,")"]})}function Ln({dumps:e,filter:t}){const r=t.toLowerCase(),s=[],c=[],i=[],a=[];for(const o of e)if(o.sync){for(const _ of o.sync.mpsc_channels)s.push({process:o.process_name,ch:_});for(const _ of o.sync.oneshot_channels)c.push({process:o.process_name,ch:_});for(const _ of o.sync.watch_channels)i.push({process:o.process_name,ch:_});for(const _ of o.sync.once_cells)a.push({process:o.process_name,ch:_})}const l=(o,_)=>!r||o.toLowerCase().includes(r)||_.toLowerCase().includes(r);return n("div",{class:"fade-in",children:[s.length>0&&n("div",{class:"card",style:"margin-bottom: 16px",children:[n("div",{class:"card-head",children:"MPSC Channels"}),n("table",{children:[n("thead",{children:n("tr",{children:[n("th",{children:"Process"}),n("th",{children:"Name"}),n("th",{children:"Type"}),n("th",{children:"Sent"}),n("th",{children:"Recv"}),n("th",{children:"Senders"}),n("th",{children:"Waiters"}),n("th",{children:"Age"}),n("th",{children:"Creator"})]})}),n("tbody",{children:s.filter(o=>l(o.process,o.ch.name)).map((o,_)=>n("tr",{class:$(o.ch.send_waiters>0&&"severity-warn",(o.ch.sender_closed||o.ch.receiver_closed)&&"severity-danger"),children:[n("td",{class:"mono",children:o.process}),n("td",{class:"mono",children:o.ch.name}),n("td",{class:"mono",children:o.ch.bounded?`bounded(${o.ch.capacity})`:"unbounded"}),n("td",{class:"num",children:o.ch.sent}),n("td",{class:"num",children:o.ch.received}),n("td",{class:"num",children:o.ch.sender_count}),n("td",{class:$("num",o.ch.send_waiters>0&&"text-amber"),children:o.ch.send_waiters}),n("td",{class:"num",children:L(o.ch.age_secs)}),n("td",{children:ee(o.ch.creator_task_id,o.ch.creator_task_name)})]},_))})]})]}),c.length>0&&n("div",{class:"card",style:"margin-bottom: 16px",children:[n("div",{class:"card-head",children:"Oneshot Channels"}),n("table",{children:[n("thead",{children:n("tr",{children:[n("th",{children:"Process"}),n("th",{children:"Name"}),n("th",{children:"State"}),n("th",{children:"Age"}),n("th",{children:"Creator"})]})}),n("tbody",{children:c.filter(o=>l(o.process,o.ch.name)).map((o,_)=>n("tr",{children:[n("td",{class:"mono",children:o.process}),n("td",{class:"mono",children:o.ch.name}),n("td",{children:n("span",{class:$("state-badge",Le(o.ch.state)),children:o.ch.state})}),n("td",{class:"num",children:L(o.ch.age_secs)}),n("td",{children:ee(o.ch.creator_task_id,o.ch.creator_task_name)})]},_))})]})]}),i.length>0&&n("div",{class:"card",style:"margin-bottom: 16px",children:[n("div",{class:"card-head",children:"Watch Channels"}),n("table",{children:[n("thead",{children:n("tr",{children:[n("th",{children:"Process"}),n("th",{children:"Name"}),n("th",{children:"Changes"}),n("th",{children:"Receivers"}),n("th",{children:"Age"}),n("th",{children:"Creator"})]})}),n("tbody",{children:i.filter(o=>l(o.process,o.ch.name)).map((o,_)=>n("tr",{children:[n("td",{class:"mono",children:o.process}),n("td",{class:"mono",children:o.ch.name}),n("td",{class:"num",children:o.ch.changes}),n("td",{class:"num",children:o.ch.receiver_count}),n("td",{class:"num",children:L(o.ch.age_secs)}),n("td",{children:ee(o.ch.creator_task_id,o.ch.creator_task_name)})]},_))})]})]}),a.length>0&&n("div",{class:"card",children:[n("div",{class:"card-head",children:"OnceCells"}),n("table",{children:[n("thead",{children:n("tr",{children:[n("th",{children:"Process"}),n("th",{children:"Name"}),n("th",{children:"State"}),n("th",{children:"Age"}),n("th",{children:"Init Duration"})]})}),n("tbody",{children:a.filter(o=>l(o.process,o.ch.name)).map((o,_)=>n("tr",{children:[n("td",{class:"mono",children:o.process}),n("td",{class:"mono",children:o.ch.name}),n("td",{children:n("span",{class:$("state-badge",Le(o.ch.state)),children:o.ch.state})}),n("td",{class:"num",children:L(o.ch.age_secs)}),n("td",{class:"num",children:o.ch.init_duration_secs!=null?(o.ch.init_duration_secs*1e3).toFixed(0)+"ms":"—"})]},_))})]})]})]})}function $n({dumps:e,filter:t}){const r=t.toLowerCase(),s=e.filter(c=>!r||c.process_name.toLowerCase().includes(r));return e.length===0?n("div",{class:"empty-state fade-in",children:[n("div",{class:"icon",children:"P"}),n("p",{children:"No processes"}),n("p",{class:"sub",children:"Waiting for instrumented processes to connect..."})]}):n("div",{class:"card-grid fade-in",children:s.map(c=>n(xn,{dump:c},`${c.process_name}-${c.pid}`))})}function xn({dump:e}){var a,l,o,_,h;const t=((a=e.roam)==null?void 0:a.connections.length)??0,r=((l=e.roam)==null?void 0:l.connections.reduce((d,p)=>d+p.in_flight.length,0))??0,s=((o=e.roam)==null?void 0:o.connections.reduce((d,p)=>d+p.total_completed,0))??0,c=((_=e.roam)==null?void 0:_.connections.reduce((d,p)=>d+p.transport.bytes_sent,0))??0,i=((h=e.roam)==null?void 0:h.connections.reduce((d,p)=>d+p.transport.bytes_received,0))??0;return n("div",{class:"proc-card",children:[n("div",{class:"proc-card-head",children:[n("div",{class:"dot",style:"background: var(--purple)"}),n("div",{class:"name",children:e.process_name}),n("div",{class:"pid",children:["pid ",e.pid]})]}),n("div",{class:"proc-card-body",children:[n("div",{class:"proc-kv",children:[n("div",{class:"proc-kv-item",children:[n("span",{class:"k",children:"Tasks"}),n("span",{class:"v",children:e.tasks.length})]}),n("div",{class:"proc-kv-item",children:[n("span",{class:"k",children:"Threads"}),n("span",{class:"v",children:e.threads.length})]}),t>0&&n(B,{children:[n("div",{class:"proc-kv-item",children:[n("span",{class:"k",children:"Connections"}),n("span",{class:"v",children:t})]}),n("div",{class:"proc-kv-item",children:[n("span",{class:"k",children:"In-flight"}),n("span",{class:"v",children:r})]}),n("div",{class:"proc-kv-item",children:[n("span",{class:"k",children:"Completed"}),n("span",{class:"v",children:s})]}),n("div",{class:"proc-kv-item",children:[n("span",{class:"k",children:"TX / RX"}),n("span",{class:"v",children:[H(c)," / ",H(i)]})]})]}),e.locks&&n("div",{class:"proc-kv-item",children:[n("span",{class:"k",children:"Contended locks"}),n("span",{class:"v",children:e.locks.locks.length})]})]}),n("div",{class:"proc-section",style:"font-size: 11px; color: var(--fg-muted)",children:["Timestamp: ",e.timestamp]})]})]})}function Sn({dumps:e,filter:t}){const r=[];for(const i of e)if(i.roam)for(const a of i.roam.connections)r.push({...a,process:i.process_name});const s=t.toLowerCase(),c=r.filter(i=>{var a;return!s||i.process.toLowerCase().includes(s)||i.name.toLowerCase().includes(s)||(((a=i.peer_name)==null?void 0:a.toLowerCase().includes(s))??!1)});return r.length===0?n("div",{class:"empty-state fade-in",children:[n("div",{class:"icon",children:"C"}),n("p",{children:"No connections"})]}):n("div",{class:"card fade-in",children:n("table",{children:[n("thead",{children:n("tr",{children:[n("th",{children:"Process"}),n("th",{children:"Name"}),n("th",{children:"Peer"}),n("th",{children:"Age"}),n("th",{children:"In-Flight"}),n("th",{children:"Completed"}),n("th",{children:"Channels"}),n("th",{children:"TX"}),n("th",{children:"RX"}),n("th",{children:"Last Activity"})]})}),n("tbody",{children:c.map((i,a)=>n("tr",{children:[n("td",{class:"mono",children:i.process}),n("td",{class:"mono",children:i.name}),n("td",{class:"mono",children:i.peer_name??n("span",{class:"muted",children:"?"})}),n("td",{class:"num",children:L(i.age_secs)}),n("td",{class:"num",children:i.in_flight.length}),n("td",{class:"num",children:i.total_completed}),n("td",{class:"num",children:i.channels.length}),n("td",{class:"num",children:[H(i.transport.bytes_sent),n("span",{class:"muted",children:[" (",i.transport.frames_sent,"f)"]})]}),n("td",{class:"num",children:[H(i.transport.bytes_received),n("span",{class:"muted",children:[" (",i.transport.frames_received,"f)"]})]}),n("td",{class:"num",children:i.transport.last_recv_ago_secs!=null?y(i.transport.last_recv_ago_secs)+" ago":"—"})]},a))})]})})}function Tn(e){return e.elapsed_secs>10?"severity-danger":e.elapsed_secs>2?"severity-warn":""}function Pn({dumps:e,filter:t}){const r=[];for(const i of e)if(i.roam)for(const a of i.roam.connections)for(const l of a.in_flight)r.push({...l,process:i.process_name,connection:a.name,peer:a.peer_name??"?"});r.sort((i,a)=>a.elapsed_secs-i.elapsed_secs);const s=t.toLowerCase(),c=r.filter(i=>{var a;return!s||i.process.toLowerCase().includes(s)||(((a=i.method_name)==null?void 0:a.toLowerCase().includes(s))??!1)||i.connection.toLowerCase().includes(s)||i.peer.toLowerCase().includes(s)});return r.length===0?n("div",{class:"empty-state fade-in",children:[n("div",{class:"icon",children:"R"}),n("p",{children:"No in-flight requests"})]}):n("div",{class:"card fade-in",children:n("table",{children:[n("thead",{children:n("tr",{children:[n("th",{children:"Dir"}),n("th",{children:"Process"}),n("th",{children:"Method"}),n("th",{children:"Elapsed"}),n("th",{children:"Connection"}),n("th",{children:"Peer"}),n("th",{children:"Request ID"}),n("th",{children:"Backtrace"})]})}),n("tbody",{children:c.map((i,a)=>n("tr",{class:Tn(i),children:[n("td",{children:n("span",{class:$("dir",i.direction==="Outgoing"?"dir-out":"dir-in"),children:i.direction==="Outgoing"?"→":"←"})}),n("td",{class:"mono",children:i.process}),n("td",{class:"mono",children:i.method_name??`method_${i.method_id}`}),n("td",{class:"num",children:y(i.elapsed_secs)}),n("td",{class:"mono",children:i.connection}),n("td",{class:"mono",children:i.peer}),n("td",{class:"num",children:i.request_id}),n("td",{children:n(q,{content:i.backtrace})})]},a))})]})})}function Nn({dumps:e,filter:t}){const r=t.toLowerCase(),s=[];for(const i of e)if(i.shm)for(const a of i.shm.segments)s.push({process:i.process_name,seg:a});const c=s.filter(i=>{var a;return!r||i.process.toLowerCase().includes(r)||(((a=i.seg.segment_path)==null?void 0:a.toLowerCase().includes(r))??!1)});return s.length===0?n("div",{class:"empty-state fade-in",children:[n("div",{class:"icon",children:"S"}),n("p",{children:"No SHM segments"})]}):n("div",{class:"fade-in",children:c.map((i,a)=>n("div",{class:"card",style:"margin-bottom: 16px",children:[n("div",{class:"card-head",children:[n("span",{class:"mono",children:i.process}),n("span",{class:"muted",children:"/"}),n("span",{class:"mono",children:i.seg.segment_path??"anonymous"}),n("span",{class:"muted",style:"margin-left: auto",children:[H(i.seg.current_size)," / ",H(i.seg.total_size)]})]}),n("table",{children:[n("thead",{children:n("tr",{children:[n("th",{children:"Peer"}),n("th",{children:"Name"}),n("th",{children:"State"}),n("th",{children:"Buf Cap"}),n("th",{children:"TX"}),n("th",{children:"RX"}),n("th",{children:"Calls TX"}),n("th",{children:"Calls RX"}),n("th",{children:"Heartbeat"})]})}),n("tbody",{children:i.seg.peers.map(l=>n("tr",{children:[n("td",{class:"num",children:l.peer_id}),n("td",{class:"mono",children:l.name??n("span",{class:"muted",children:"—"})}),n("td",{class:"mono",children:l.state}),n("td",{class:"num",children:H(l.bipbuf_capacity)}),n("td",{class:"num",children:H(l.bytes_sent)}),n("td",{class:"num",children:H(l.bytes_received)}),n("td",{class:"num",children:l.calls_sent}),n("td",{class:"num",children:l.calls_received}),n("td",{class:"num",children:l.time_since_heartbeat_ms!=null?l.time_since_heartbeat_ms+"ms":"—"})]},l.peer_id))})]})]},a))})}const Hn=["Tasks","Threads","Locks","Channels","RPC","SHM"];function En({dumps:e,filter:t}){const r=Be(e),s=t.toLowerCase(),c=s?r.filter(o=>o.process.toLowerCase().includes(s)||o.resource.toLowerCase().includes(s)||o.description.toLowerCase().includes(s)||o.category.toLowerCase().includes(s)):r;if(c.length===0)return n("div",{class:"fade-in",children:n("div",{class:"empty-state",children:[n("div",{class:"icon",style:"color: var(--green)",children:"&check;"}),n("p",{children:"No problems detected"}),n("p",{class:"sub",children:"All systems nominal"})]})});const i=c.filter(o=>o.severity==="danger").length,a=c.filter(o=>o.severity==="warn").length,l=new Map;for(const o of c){let _=l.get(o.category);_||(_=[],l.set(o.category,_)),_.push(o)}return n("div",{class:"fade-in",children:[n("div",{class:"problems-summary",children:[i>0&&n("span",{class:"problems-count problems-count-danger",children:[i," danger"]}),a>0&&n("span",{class:"problems-count problems-count-warn",children:[a," warning",a!==1?"s":""]})]}),Hn.filter(o=>l.has(o)).map(o=>{const _=l.get(o);return n("div",{class:"card",children:[n("div",{class:"card-head",children:o}),n("table",{children:[n("thead",{children:n("tr",{children:[n("th",{children:"Severity"}),n("th",{children:"Process"}),n("th",{children:"Resource"}),n("th",{children:"Description"}),n("th",{children:"Timing"}),n("th",{children:"Backtrace"})]})}),n("tbody",{children:_.map((h,d)=>n("tr",{class:$(h.severity==="danger"&&"severity-danger",h.severity==="warn"&&"severity-warn"),children:[n("td",{children:n("span",{class:$("state-badge",h.severity==="danger"?"state-dropped":"state-pending"),children:h.severity})}),n("td",{class:"mono",children:h.process}),n("td",{class:"mono",children:h.resource}),n("td",{children:h.description}),n("td",{class:"num",children:h.timingLabel}),n("td",{children:n(q,{content:h.backtrace})})]},d))})]})]},o)})]})}const Fn=["problems","tasks","threads","locks","sync","requests","connections","processes","shm"],Rn=2e3,An=3;function Dn(){const[e,t]=D([]),[r,s]=D("problems"),[c,i]=D(""),[a,l]=D(null),o=Qe(null);Je(()=>{let f=!1,k=null,g=0,m=null;function x(){if(m)return;const T=async()=>{try{const P=await we();f||(t(P),l(null))}catch(P){f||l(String(P))}};T(),m=setInterval(T,2e3)}function S(){m&&(clearInterval(m),m=null)}function F(){if(f)return;const T=tn({onDumps:P=>{f||(g=0,t(P),l(null),S())},onError:P=>{f||l(P)},onClose:()=>{f||(g++,g>=An&&x(),k=setTimeout(F,Rn))}});o.current=T}return F(),()=>{f=!0,k&&clearTimeout(k),S(),o.current&&(o.current(),o.current=null)}},[]);const _=async()=>{try{const f=await we();t(f),l(null)}catch(f){l(String(f))}},h=e.some(f=>f.sync!=null),d=e.some(f=>f.roam!=null),p=e.some(f=>f.shm!=null),u=e.some(f=>f.locks!=null),w=Fn.filter(f=>f==="problems"?!0:!(f==="sync"&&!h||f==="requests"&&!d||f==="connections"&&!d||f==="shm"&&!p||f==="locks"&&!u));return n("div",{class:"app",children:[n(sn,{dumps:e,filter:c,onFilter:i,onRefresh:_,error:a}),n(fn,{tabs:w,active:r,onSelect:s,dumps:e}),n("div",{class:"content",children:[r==="problems"&&n(En,{dumps:e,filter:c}),r==="tasks"&&n(vn,{dumps:e,filter:c}),r==="threads"&&n(wn,{dumps:e,filter:c}),r==="locks"&&n(Cn,{dumps:e,filter:c}),r==="sync"&&n(Ln,{dumps:e,filter:c}),r==="requests"&&n(Pn,{dumps:e,filter:c}),r==="connections"&&n(Sn,{dumps:e,filter:c}),r==="processes"&&n($n,{dumps:e,filter:c}),r==="shm"&&n(Nn,{dumps:e,filter:c})]})]})}Ke(n(Dn,{}),document.getElementById("app"));
